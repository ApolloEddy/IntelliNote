## 2026-02-12 (Chat Timeout Budget Fix): DashScope å¤šè·¯é‡è¯•æ”¹ä¸ºæ€»è¶…æ—¶é¢„ç®—

### ğŸ¯ ç›®æ ‡
ä¿®å¤ `DASHSCOPE_CHAT_TIMEOUT_SECONDS=90` åœ¨ä¸‰è·¯é‡è¯•åœºæ™¯ä¸‹è¢«æŒ‰â€œæ¯æ¬¡å°è¯• 90sâ€æ‰§è¡Œï¼Œå¯¼è‡´æ€»ç­‰å¾…æ—¶é—´å¯è¶… 120s å®¢æˆ·ç«¯è¶…æ—¶çš„é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `server/app/api/endpoints/chat.py`
  - `_call_dashscope_chat` çš„è¶…æ—¶ç­–ç•¥ä»â€œæ¯æ¬¡é‡è¯•ä½¿ç”¨å®Œæ•´è¶…æ—¶â€æ”¹ä¸ºâ€œå…±äº«æ€»é¢„ç®—è¶…æ—¶â€ã€‚
  - æ–°å¢æ€»é¢„ç®—æ§åˆ¶ï¼šæŒ‰å°è¯•æ•°åˆ‡åˆ†å•æ¬¡è¯·æ±‚è¶…æ—¶ï¼Œå¹¶åœ¨å¾ªç¯å†…æ ¹æ®å‰©ä½™é¢„ç®—åŠ¨æ€æ”¶æ•›ã€‚
  - å½“é¢„ç®—è€—å°½ä¸”æ— æ˜ç¡®é”™è¯¯æ—¶ï¼Œè¿”å› `timeout: exhausted total budget Ns` è¯Šæ–­ä¿¡æ¯ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ä»£ç†æ³¢åŠ¨æ—¶ä¸‰è·¯å›é€€ (`primary/no_proxy/proxy_off`) å åŠ è¶…æ—¶å¯¼è‡´å‰ç«¯å…ˆæŠ¥ `è¯·æ±‚è¶…æ—¶` çš„é—®é¢˜ã€‚

### âœ… éªŒè¯ (Validation)
- `venv\Scripts\python.exe -m py_compile app\api\endpoints\chat.py`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å¯¹è¯è¶…æ—¶è¯­ä¹‰ç»Ÿä¸€ä¸ºâ€œæ€»é¢„ç®—â€è€Œéâ€œå•æ¬¡å°è¯•â€ï¼Œä¸é…ç½®é¡¹å‘½åå’Œå®¢æˆ·ç«¯è¶…æ—¶é¢„æœŸä¿æŒä¸€è‡´ã€‚

---

## 2026-02-12 (Client Timeout Tuning): å¯¹è¯æµè¶…æ—¶ä» 30s æå‡åˆ° 120s

### ğŸ¯ ç›®æ ‡
é¿å… RAG å·²è¿”å›å¼•ç”¨ä½† LLM ç”Ÿæˆé˜¶æ®µå°šæœªå®Œæˆæ—¶ï¼Œå®¢æˆ·ç«¯è¿‡æ—©è§¦å‘ `è¯·æ±‚è¶…æ—¶`ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `client/lib/app/app_state.dart`
  - æ–°å¢å¸¸é‡ `kChatStreamTimeoutSeconds = 120`ã€‚
  - å¯¹è¯æµè¶…æ—¶ä» `30s` è°ƒæ•´ä¸º `120s`ã€‚
  - è¶…æ—¶é”™è¯¯æ–‡æ¡ˆæ”¹ä¸ºæ˜¾ç¤ºå…·ä½“é˜ˆå€¼ï¼š`è¯·æ±‚è¶…æ—¶ï¼ˆ120sï¼‰ï¼Œè¯·é‡è¯•`ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub lib/app/app_state.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ä»…å®¢æˆ·ç«¯æµæ§å‚æ•°è°ƒæ•´ï¼Œä¸å½±å“åç«¯æ¥å£åè®®ä¸æ•°æ®ç»“æ„ã€‚

---

## 2026-02-12 (Chat Timeout Tuning): DashScope å¯¹è¯è¶…æ—¶æå‡è‡³ 90s

### ğŸ¯ ç›®æ ‡
ç¼“è§£ DashScope åœ¨ä»£ç†æ³¢åŠ¨åœºæ™¯ä¸‹çš„ `Read timed out (20s)` é—®é¢˜ï¼Œæå‡é•¿å“åº”è¯·æ±‚æˆåŠŸç‡ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `server/app/core/config.py`
  - æ–°å¢é…ç½®é¡¹ `DASHSCOPE_CHAT_TIMEOUT_SECONDS`ï¼Œé»˜è®¤å€¼ `90`ã€‚
- `server/app/api/endpoints/chat.py`
  - `_call_dashscope_chat` è¯·æ±‚è¶…æ—¶æ”¹ä¸ºè¯»å–é…ç½®é¡¹ï¼ˆæœ€å°ä¿æŠ¤å€¼ 10sï¼‰ï¼Œé»˜è®¤å®é™…ä¸º `90s`ã€‚

### âœ… éªŒè¯ (Validation)
- `venv\Scripts\python.exe -m py_compile app\core\config.py app\api\endpoints\chat.py`
- `venv\Scripts\python.exe -m pytest -q tests/test_chat_citation_page_number.py tests/test_full_suite.py`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- è¶…æ—¶ç­–ç•¥ä»ç¡¬ç¼–ç å¸¸é‡è½¬ä¸ºé…ç½®é©±åŠ¨ï¼Œå¯é€šè¿‡ `.env` æ— ä»£ç è°ƒå‚ã€‚

---

## 2026-02-12 (PDF Page Preview): Sources æ”¯æŒæŒ‰é¡µæ‹‰å–çœŸå® PDF å†…å®¹é¢„è§ˆ

### ğŸ¯ ç›®æ ‡
å°†â€œå¼•ç”¨å®šä½â€ä»ç‰‡æ®µçº§å¢å¼ºåˆ°é¡µçº§ï¼šå½“å¼•ç”¨æ¥è‡ª PDF ä¸”å¸¦é¡µç æ—¶ï¼Œå…è®¸åœ¨ Sources ç›´æ¥æ‹‰å–å¹¶æŸ¥çœ‹è¯¥é¡µçœŸå®æ–‡æœ¬é¢„è§ˆã€‚

### â• æ–°å¢ (Added)
- åç«¯æ–°å¢ PDF é¡µé¢„è§ˆèƒ½åŠ›ï¼š
  - æ–°å¢ `server/app/services/pdf_preview.py`ï¼Œæä¾›ç‹¬ç«‹çš„é¡µæ–‡æœ¬æå–å‡½æ•° `extract_pdf_page_preview`ã€‚
  - æ–°å¢æ¥å£ `GET /api/v1/files/{doc_id}/page/{page_number}`ï¼Œè¿”å›é¡µç ã€æ€»é¡µæ•°ã€æ–‡æœ¬ã€å­—ç¬¦æ•°ã€å›¾ç‰‡å æ¯”ã€‚
- å‰ç«¯æ–°å¢é¡µçº§é¢„è§ˆå…¥å£ï¼š
  - Sources å®šä½æ¨ªå¹…æ–°å¢â€œæŸ¥çœ‹é¡µé¢„è§ˆâ€æŒ‰é’®ï¼ˆä»… PDF + æœ‰é¡µç æ—¶æ˜¾ç¤ºï¼‰ã€‚
  - æ–°å¢é¡µé¢„è§ˆå¼¹çª—ï¼Œæ”¯æŒåŠ è½½æ€ã€é”™è¯¯æ€ä¸æ–‡æœ¬å±•ç¤ºã€‚
- æ–°å¢æµ‹è¯•ï¼š
  - `server/tests/test_pdf_page_preview_reader.py`ï¼ˆè¦†ç›–é¡µæå–æ­£å¸¸/è¶Šç•Œåœºæ™¯ï¼‰ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `client/lib/core/api_client.dart` æ–°å¢ `getPdfPagePreview`ã€‚
- `client/lib/app/app_state.dart` æ–°å¢ `getPdfPagePreview` é€ä¼ æ–¹æ³•ã€‚
- `client/lib/features/sources/sources_page.dart` å®šä½æ¨ªå¹…æ‰©å±•é¡µçº§é¢„è§ˆäº¤äº’ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œéœ€è¦æŸ¥çœ‹å¼•ç”¨æ‰€åœ¨çœŸå®é¡µå†…å®¹æ—¶ï¼Œåªèƒ½çœ‹æˆªæ–­ç‰‡æ®µâ€çš„ä½“éªŒç¼ºå£ã€‚
- ä¿®å¤æµ‹è¯•å¯¼å…¥é“¾å‰¯ä½œç”¨é—®é¢˜ï¼šé¡µé¢„è§ˆæ ¸å¿ƒé€»è¾‘ä» endpoint æ–‡ä»¶å‰¥ç¦»åˆ° service å±‚ï¼Œé¿å…æµ‹è¯•æ—¶è§¦å‘ Worker/LLM åˆå§‹åŒ–ä¾èµ–ã€‚

### âœ… éªŒè¯ (Validation)
- `venv\Scripts\python.exe -m py_compile app\api\endpoints\files.py app\services\pdf_preview.py`
- `venv\Scripts\python.exe -m pytest -q tests/test_pdf_page_preview_reader.py tests/test_document_parser.py tests/test_chat_citation_page_number.py tests/test_files_extension_validation.py tests/test_full_suite.py`
- `flutter analyze --no-pub lib/features/sources/sources_page.dart lib/app/app_state.dart lib/core/api_client.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- é¡µé¢„è§ˆæå–é€»è¾‘ç‹¬ç«‹äº `files.py` è·¯ç”±å±‚ï¼Œä¿æŒâ€œæ¥å£ç¼–æ’â€ä¸â€œPDFè§£æå®ç°â€åˆ†ç¦»ï¼Œä¾¿äºåç»­æ‰©å±•åˆ°ç¼©ç•¥å›¾/OCRé¡µä¸“ç”¨ç­–ç•¥ã€‚

---

## 2026-02-12 (Citation Preview UX): æ¥æºå®šä½æ¨ªå¹…å¢åŠ ç‰‡æ®µé¢„è§ˆä¸å…¨æ–‡æŸ¥çœ‹

### ğŸ¯ ç›®æ ‡
åœ¨â€œå¼•ç”¨è·³è½¬æ¥æºâ€åŸºç¡€ä¸Šï¼Œè¡¥é½å¿«é€Ÿé˜…è¯»èƒ½åŠ›ï¼šç”¨æˆ·åˆ‡åˆ° Sources åå¯ç›´æ¥çœ‹åˆ°å¼•ç”¨ç‰‡æ®µé¢„è§ˆï¼Œå¹¶ä¸€é”®æ‰“å¼€å®Œæ•´ç‰‡æ®µã€‚

### â• æ–°å¢ (Added)
- `Sources` å®šä½æ¨ªå¹…æ–°å¢ï¼š
  - ç‰‡æ®µé¢„è§ˆæ–‡æœ¬ï¼ˆæˆªæ–­å±•ç¤ºï¼‰
  - `æŸ¥çœ‹ç‰‡æ®µ` æŒ‰é’®ï¼ˆå¼¹çª—å±•ç¤ºå®Œæ•´ç‰‡æ®µï¼‰
- ç‚¹å‡»é¢„è§ˆæ–‡æœ¬å¯ç›´æ¥æ‰“å¼€å®Œæ•´ç‰‡æ®µå¼¹çª—ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `client/lib/features/sources/sources_page.dart`ï¼š
  - `_SourceFocusBanner` æ‰©å±• `snippet` ä¸ `onOpenSnippet` å‚æ•°ã€‚
  - `SourcesPage` æ–°å¢ `_showFocusedSnippetDialog`ï¼Œç»Ÿä¸€å¤„ç†ç‰‡æ®µå¼¹çª—å±•ç¤ºã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œè·³è½¬åˆ°æ¥æºååªèƒ½é«˜äº®ã€æ— æ³•å¿«é€Ÿé˜…è¯»å¼•ç”¨å†…å®¹â€çš„äº¤äº’æ–­å±‚ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub lib/features/sources/sources_page.dart lib/features/chat/chat_page.dart lib/features/notebook/notebook_page.dart lib/app/app_state.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ä»…å‰ç«¯å±•ç¤ºå±‚å¢å¼ºï¼Œä¸å˜æ›´åç«¯æ¥å£ä¸æŒä¹…åŒ–ç»“æ„ã€‚

---

## 2026-02-12 (Citation Jump UX): å¯¹è¯å¼•ç”¨ä¸€é”®å®šä½åˆ°æ¥æºå¡ç‰‡

### ğŸ¯ ç›®æ ‡
åœ¨ PDF-RAG å¼•ç”¨å¯è¿½æº¯åŸºç¡€ä¸Šï¼Œè¡¥é½â€œä»èŠå¤©å¼•ç”¨è·³è½¬åˆ°æ¥æºåˆ—è¡¨â€çš„äº¤äº’é—­ç¯ï¼Œå‡å°‘ç”¨æˆ·æ‰‹åŠ¨æŸ¥æ‰¾æ¥æºæˆæœ¬ã€‚

### â• æ–°å¢ (Added)
- `ChatPage` å¼•ç”¨å¼¹çª—æ–°å¢â€œæŸ¥çœ‹æ¥æºâ€æŒ‰é’®ï¼š
  - ç‚¹å‡»åè§¦å‘æ¥æºå®šä½åŠ¨ä½œå¹¶åˆ‡æ¢åˆ° Sources é¡µã€‚
- `AppState` æ–°å¢æ¥æºå®šä½çŠ¶æ€ç®¡ç†ï¼š
  - `focusSourceFromCitation`
  - `sourceFocusFor`
  - `clearSourceFocus`
- `SourcesPage` æ–°å¢å®šä½æç¤ºæ¨ªå¹…ä¸å¡ç‰‡é«˜äº®æ ·å¼ï¼ˆå«å¯é€‰é¡µç æç¤ºï¼‰ã€‚
- æ–°å¢çŠ¶æ€æµ‹è¯•ï¼š
  - `client/test/app_state_settings_test.dart` å¢åŠ â€œæ¥æºå®šä½çŠ¶æ€å¯è®¾ç½®ä¸æ¸…é™¤â€ç”¨ä¾‹ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `NotebookPage`ï¼š
  - æ¥å…¥ `ChatPage` çš„å¼•ç”¨è·³è½¬å›è°ƒï¼Œæ”¶åˆ°å®šä½è¯·æ±‚æ—¶è‡ªåŠ¨åˆ‡æ¢è‡³ Sources tabã€‚
  - å½“å¼•ç”¨å¯¹åº”æ¥æºä¸å­˜åœ¨æ—¶ï¼Œç»™å‡ºæ˜ç¡®æç¤ºï¼Œä¸æ‰§è¡Œæ— æ•ˆè·³è½¬ã€‚
- `SourcesPage`ï¼š
  - è¢«å®šä½æ¥æºå¡ç‰‡æ˜¾ç¤ºâ€œå·²å®šä½åˆ°å¼•ç”¨æ¥æºï¼ˆç¬¬ N é¡µï¼‰â€çŠ¶æ€æ–‡æ¡ˆã€‚
  - æ”¯æŒâ€œä¸€é”®æ¸…é™¤å®šä½æ€â€ï¼Œé¿å…æ®‹ç•™é«˜äº®é€ æˆè¯¯å¯¼ã€‚
- `AppState.deleteSource/deleteNotebook`ï¼š
  - åˆ é™¤æ¥æºæˆ–ç¬”è®°æœ¬æ—¶åŒæ­¥æ¸…ç†å®šä½æ€ï¼Œé˜²æ­¢æ‚¬æŒ‚çŠ¶æ€ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œå¼•ç”¨å¯è§ä½†æ— æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”æ¥æºå¡ç‰‡â€çš„äº¤äº’æ–­é“¾ã€‚
- ä¿®å¤â€œè¢«åˆ é™¤æ¥æºä»å¯èƒ½æ®‹ç•™å®šä½æ€â€çš„çŠ¶æ€ä¸€è‡´æ€§é£é™©ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub lib/features/notebook/notebook_page.dart lib/features/chat/chat_page.dart lib/features/sources/sources_page.dart lib/app/app_state.dart test/app_state_settings_test.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æ–°å¢å®šä½æ€ä¸ºçº¯å‰ç«¯ä¸´æ—¶çŠ¶æ€ï¼Œä¸è¿›å…¥æŒä¹…åŒ–å­˜å‚¨ï¼Œä¸å½±å“æ—¢æœ‰ Notebook/Sources/Chat æ•°æ®ç»“æ„ã€‚
- å¼•ç”¨è·³è½¬é“¾è·¯é€šè¿‡å›è°ƒè§£è€¦ï¼š`ChatPage -> NotebookPage -> AppState -> SourcesPage`ï¼Œé¿å…è·¨é¡µé¢ç›´æ¥ä¾èµ–ã€‚

---

## 2026-02-12 (Worker Hotfix): PyMuPDF ç¼ºå¤±å¿«é€Ÿå¤±è´¥ + Celery äº‹ä»¶å¾ªç¯ä¿®å¤

### ğŸ¯ ç›®æ ‡
ä¿®å¤ PDF ä»»åŠ¡åœ¨ Worker ä¸­å› ç¼ºå°‘ PyMuPDF å¯¼è‡´çš„é‡è¯•é£æš´ï¼Œä»¥åŠé‡è¯•çº¿ç¨‹ `Timer-1` æ— äº‹ä»¶å¾ªç¯å¼•å‘çš„äºŒæ¬¡å¼‚å¸¸ã€‚

### â• æ–°å¢ (Added)
- æ— ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `server/app/worker/tasks.py`ï¼š
  - å°†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä» `get_event_loop + run_until_complete` æ”¹ä¸º `asyncio.run(...)`ï¼Œé¿å…çº¿ç¨‹ä¸Šä¸‹æ–‡ç¼ºå¤±äº‹ä»¶å¾ªç¯ã€‚
- `server/app/worker/retry_policy.py`ï¼š
  - å°† `PyMuPDF is required for PDF parsing` ä¸ `No module named 'fitz'` çº³å…¥ä¸å¯é‡è¯•é”™è¯¯åˆ¤å®šã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ `RuntimeError: There is no current event loop in thread 'Timer-1'` çš„ Worker é‡è¯•å´©æºƒã€‚
- ä¿®å¤ `PyMuPDF` ç¼ºå¤±æ—¶é‡å¤é‡è¯•å¯¼è‡´çš„ä»»åŠ¡å™ªéŸ³ä¸çŠ¶æ€æ”¶æ•›å»¶è¿Ÿã€‚

### âœ… éªŒè¯ (Validation)
- `venv\Scripts\python.exe -m pip install PyMuPDF`
- `venv\Scripts\python.exe -m py_compile app\worker\tasks.py app\worker\retry_policy.py app\services\document_parser.py`
- `venv\Scripts\python.exe -m pytest -q tests/test_document_parser.py tests/test_chat_citation_page_number.py`
- `venv\Scripts\python.exe -m pytest -q tests/test_full_suite.py tests/test_files_extension_validation.py`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- Worker æ‰§è¡Œæ¨¡å‹æ›´ç¨³å®šï¼šæ¯æ¬¡ä»»åŠ¡åˆ›å»ºç‹¬ç«‹äº‹ä»¶å¾ªç¯ï¼Œé¿å…çº¿ç¨‹å¤ç”¨æ—¶çš„çŠ¶æ€æ±¡æŸ“ã€‚
- PDF ä¾èµ–ç¼ºå¤±åœºæ™¯ä»â€œå¯é‡è¯•å™ªéŸ³é”™è¯¯â€æ”¶æ•›ä¸ºâ€œä¸€æ¬¡å¤±è´¥ã€æ˜ç¡®åŸå› â€çš„ç¡®å®šæ€§è¡Œä¸ºã€‚

---

## 2026-02-12 (PDF-RAG Phase 1): PDF å¯¼å…¥è§£æ + é¡µç å¼•ç”¨ + å¯é€‰ Qwen OCR

### ğŸ¯ ç›®æ ‡
åœ¨ä¸ç ´åç°æœ‰ TXT/MD RAG é“¾è·¯çš„å‰æä¸‹ï¼Œè½åœ° PDF ä¸€é˜¶æ®µèƒ½åŠ›ï¼šæ”¯æŒ PDF å¯¼å…¥ã€é¡µç çº§å¯è¿½æº¯å¼•ç”¨ï¼Œä»¥åŠæ‰«æé¡µå¯é€‰ OCR çš„è§£è€¦æ‰©å±•ç‚¹ã€‚

### â• æ–°å¢ (Added)
- æ–°å¢å¯æ’æ‹”æ–‡æ¡£è§£æå±‚ `server/app/services/document_parser.py`ï¼š
  - `DocumentParserRegistry`ï¼šæŒ‰æ‰©å±•ååˆ†æµè§£æå™¨ï¼ˆTXT/MD/PDFï¼‰ã€‚
  - `PdfDocumentParser`ï¼šé¡µçº§è§£æã€å›¾ç‰‡å æ¯”åˆ¤å®šã€é¡µç å…ƒæ•°æ®æ³¨å…¥ã€‚
  - `DashScopeQwenOcrProvider`ï¼šæ‰«æé¡µ OCR çš„å¯é€‰ Providerï¼ˆé»˜è®¤å…³é—­ï¼‰ï¼Œæ¨¡å‹é»˜è®¤ `qwen-vl-max-latest`ã€‚
- æ–°å¢ PDF ç›¸å…³é…ç½®é¡¹ï¼š
  - `PDF_OCR_MODEL_NAME`ã€`PDF_OCR_ENABLED`ã€`PDF_OCR_MAX_PAGES`ã€`PDF_OCR_TIMEOUT_SECONDS`
  - `PDF_TEXT_PAGE_MIN_CHARS`ã€`PDF_SCAN_PAGE_MAX_CHARS`ã€`PDF_SCAN_IMAGE_RATIO_THRESHOLD`
- æ–°å¢æµ‹è¯•ï¼š
  - `server/tests/test_document_parser.py`
  - `server/tests/test_chat_citation_page_number.py`
  - `server/tests/test_files_extension_validation.py`
  - `client/test/citation_model_test.dart`

### ğŸ› ï¸ å˜æ›´ (Changed)
- åç«¯ ingestion æ¥å…¥è§£ææ³¨å†Œè¡¨ï¼š
  - `server/app/services/ingestion.py` ä»ç›´æ¥ `SimpleDirectoryReader` æ”¹ä¸ºç»Ÿä¸€èµ° `DocumentParserRegistry`ã€‚
  - è§£æå®Œæˆååœ¨è¿›åº¦è¯¦æƒ…ä¸­è¾“å‡ºè§£æç»Ÿè®¡ï¼ˆæ€»é¡µæ•°/æ–‡æœ¬é¡µ/OCRé¡µ/è·³è¿‡é¡µï¼‰ã€‚
- ä¸Šä¼ é“¾è·¯æ–‡ä»¶ç±»å‹ç™½åå•å‡çº§ä¸º `TXT/MD/PDF`ï¼š
  - `server/app/api/endpoints/files.py` å¢åŠ åç¼€æ ¡éªŒä¸ç»Ÿä¸€é”™è¯¯æç¤ºã€‚
  - ç™½åå•ä¸è§£æå±‚å…±äº«å•ä¸€å¸¸é‡æ¥æºï¼Œé¿å…ç­–ç•¥æ¼‚ç§»ã€‚
- å‰ç«¯å¯¼å…¥èƒ½åŠ›ä¸æ–‡æ¡ˆåŒæ­¥å‡çº§ï¼š
  - `client/lib/app/app_state.dart` æ–‡ä»¶é€‰æ‹©æ‰©å±•åˆ° `['txt', 'md', 'pdf']`ã€‚
  - `client/lib/features/sources/sources_page.dart` æ–‡æ¡ˆæ›´æ–°ä¸ºæ”¯æŒ PDFã€‚
  - `client/README.md` åŠŸèƒ½è¯´æ˜æ›´æ–°ä¸ºæ”¯æŒ PDFã€‚
- å¼•ç”¨æ•°æ®ç»“æ„å‡çº§ä¸ºâ€œå¯é€‰é¡µç â€ï¼š
  - `server/app/api/endpoints/chat.py` å¼•ç”¨æ–°å¢ `page_number`ã€‚
  - `client/lib/core/models.dart` æ–°å¢ `Citation.pageNumber`ï¼ˆå…¼å®¹ `page_number/pageNumber`ï¼‰ã€‚
  - `client/lib/app/app_state.dart` è§£æ SSE å¼•ç”¨æ—¶é€ä¼ é¡µç ã€‚
  - `client/lib/features/chat/chat_page.dart` å¼•ç”¨æ ‡ç­¾ä¸å¼¹çª—å±•ç¤ºé¡µç ä¿¡æ¯ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œPDF èƒ½å¯¼å…¥ä½†æ— æ³•è¿›å…¥æ­£ç¡®è§£æè·¯å¾„â€çš„æ¡†æ¶ç¼ºå£ï¼ˆç”±æ–‡ä»¶ hash å­˜å‚¨å¯¼è‡´æ‰©å±•åä¸å¯è§ï¼Œç°æ”¹ä¸ºæŒ‰åŸå§‹ filename åˆ†æµè§£æï¼‰ã€‚
- ä¿®å¤ PDF åœºæ™¯ä¸‹å¼•ç”¨ä»…æœ‰ç‰‡æ®µæ— é¡µç çš„é—®é¢˜ï¼Œæå‡å¯è¿½æº¯æ€§ã€‚
- ä¿®å¤ API å±‚ä¸è§£æå±‚å„è‡ªç»´æŠ¤æ‰©å±•åç™½åå•å¯¼è‡´çš„æ½œåœ¨ä¸€è‡´æ€§é£é™©ã€‚

### âœ… éªŒè¯ (Validation)
- `venv\Scripts\python.exe -m pytest -q tests/test_chat_citation_page_number.py tests/test_document_parser.py tests/test_files_extension_validation.py tests/test_full_suite.py`
- `venv\Scripts\python.exe -m py_compile app\api\endpoints\chat.py`
- `flutter test --no-pub test/citation_model_test.dart`
- `flutter analyze --no-pub lib/app/app_state.dart lib/core/models.dart lib/features/chat/chat_page.dart lib/features/sources/sources_page.dart test/citation_model_test.dart`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- è§£æå±‚ä»â€œingestion å†…éƒ¨ç¡¬ç¼–ç å•å®ç°â€å‡çº§ä¸ºâ€œæ³¨å†Œè¡¨ + è§£æå™¨ + OCR Providerâ€ä¸‰æ®µå¼ï¼š
  - å¯¹ç°æœ‰ embedding/index/chat æµç¨‹ä¿æŒå…¼å®¹ï¼›
  - æ–°å¢èƒ½åŠ›ä»¥æ‰©å±•ç‚¹æ–¹å¼æ³¨å…¥ï¼Œä¸ä¸æ ¸å¿ƒ RAG ç¼–æ’å¼ºè€¦åˆï¼›
  - åç»­å¯åœ¨ä¸æ”¹ ingestion ä¸»å¹²çš„æƒ…å†µä¸‹æ›¿æ¢ OCR æ¨¡å‹æˆ–æ–°å¢ Docx/HTML è§£æå™¨ã€‚

---

## 2026-02-12 (UX Copy Alignment): Sources ç©ºçŠ¶æ€æ–‡æ¡ˆä¸å¯¼å…¥èƒ½åŠ›å¯¹é½

### ğŸ¯ ç›®æ ‡
ä¿®å¤ Sources é¡µé¢ç©ºçŠ¶æ€æ–‡æ¡ˆä¸å®é™…å¯¼å…¥èƒ½åŠ›ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé¿å…ç”¨æˆ·è¢«â€œæ”¯æŒ PDFâ€æ–‡æ¡ˆè¯¯å¯¼ã€‚

### â• æ–°å¢ (Added)
- æ— ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `client/lib/features/sources/sources_page.dart` ç©ºçŠ¶æ€æç¤ºæ”¹ä¸ºï¼š
  - `å¯¼å…¥ TXTã€MD æˆ–ç²˜è´´æ–‡æœ¬`

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œæ–‡æ¡ˆæç¤ºæ”¯æŒ PDFï¼Œä½†å½“å‰æ–‡ä»¶é€‰æ‹©ä»…å…è®¸ TXT/MDâ€é€ æˆçš„é¢„æœŸåå·®ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æ— æ•°æ®ç»“æ„ä¸æ¥å£å˜æ›´ï¼Œä»… UI æ–‡æ¡ˆå±‚å¯¹é½æ—¢æœ‰åŠŸèƒ½è¾¹ç•Œã€‚

---

## 2026-02-10 (UX & Theme Polish v5): VSC æš—è‰²å›å½’ + æ°”æ³¡æ¨¡å¼ + é‡æ–°æ‰“åŒ…

### ğŸ¯ ç›®æ ‡
å°†å…¨å±€æš—è‰²èƒŒæ™¯æ”¶æ•›åˆ°æ›´æ¥è¿‘ VS Code Dark Theme çš„ä¸­æ€§ç°åŸºè°ƒï¼Œè¡¥é½èŠå¤©æ°”æ³¡é»˜è®¤é£æ ¼ä¸ä¸»é¢˜è”åŠ¨ï¼Œå¹¶å®Œæˆæ–° Logo çš„ Windows é‡æ‰“åŒ…ã€‚

### â• æ–°å¢ (Added)
- æ–°å¢â€œç”¨æˆ·æ°”æ³¡è‰²â€è®¾ç½®é¡¹ï¼ˆé»˜è®¤ `ChatGPT é»˜è®¤`ï¼‰ï¼š
  - `ChatGPT é»˜è®¤`ï¼šæ·±è‰²ä¸‹ä¸ºæ›´æµ…ä¸€é˜¶é»‘ç°æ°”æ³¡ï¼Œæµ…è‰²ä¸‹ä¸ºæ›´æ·±ä¸€é˜¶ç™½ç°æ°”æ³¡ã€‚
  - `è·Ÿéšä¸»é¢˜è‰²`ï¼šç”¨æˆ·æ°”æ³¡ä½¿ç”¨ä¸»é¢˜è‰²é€æ˜å±‚ã€‚
- æ–°å¢ç”¨æˆ·æ°”æ³¡è‰²é…ç½®é“¾è·¯ï¼š
  - `AppState` å¢åŠ  `userBubbleToneId` ä¸ `setUserBubbleTone`
  - æŒä¹…åŒ–å†™å…¥ `settings.userBubbleToneId` å¹¶åœ¨å¯åŠ¨æ—¶å›è¯»
- è®¾ç½®æµ‹è¯•æ–°å¢â€œæ— æ•ˆæ°”æ³¡è‰²é…ç½®è‡ªåŠ¨å›é€€â€ç”¨ä¾‹ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- å…¨å±€ä¸»é¢˜æš—è‰²åŸºçº¿å›å½’ VSC é£æ ¼ä¸­æ€§ç°ï¼š
  - `surface/surfaceContainer*`ã€`outline*` è°ƒæ•´ä¸ºéåç»¿æ·±ç°å±‚çº§
  - `scaffoldBackgroundColor` è°ƒæ•´ä¸º `#1E1E1E` åŸºåº•
- ä¸»é¢˜è‰²è”åŠ¨èŒƒå›´æ‰©å±•ï¼š
  - `NavigationBar` é€‰ä¸­é«˜äº®/å›¾æ ‡/æ ‡ç­¾é¢œè‰²ä¸ä¸»é¢˜è‰²åŒæ­¥
  - `FilterChip`ã€èŠå¤©å¼•ç”¨ `ActionChip`ã€è¿›åº¦æ¡ä¸»é¢˜ç»Ÿä¸€æ¥å…¥ä¸»é¢˜è‰²
- è¾“å…¥æ¡†æ·±è‰²å»è¾¹æ¡†ï¼š
  - å…¨å±€ `InputDecorationTheme` åœ¨ dark æ¨¡å¼ä¸‹ç§»é™¤è¾¹æ¡†
  - èŠå¤©è¾“å…¥å®¹å™¨ã€æœç´¢æ¡†ã€æ–°å»º/é‡å‘½åå¼¹çª—è¾“å…¥åŒºåœ¨ dark æ¨¡å¼ç§»é™¤è¾¹æ¡†æçº¿
- åœ†è§’ä½“ç³»æ•´ä½“ä¸‹è°ƒï¼ˆæ›´å…‹åˆ¶ï¼‰ï¼š
  - `Card/Chip/Button/Input` ç­‰å…¨å±€åœ†è§’ä¸‹è°ƒ
  - é¦–é¡µ Notebook å¡ç‰‡ã€èŠå¤©è¾“å…¥å®¹å™¨ã€æœç´¢æ¡†ã€èœå•æµ®å±‚åœ†è§’å‡å°
- é¦–é¡µ Notebook å¡ç‰‡äº¤äº’ä¼˜åŒ–ï¼š
  - å¡ç‰‡åœ†è§’å‡å°
  - å³ä¾§çœç•¥å·ç‚¹å‡»çƒ­åŒºæ”¾å¤§ä¸ºçŸ©å½¢åŒºåŸŸï¼ˆéåœ†å½¢ï¼‰
  - `ModernMenuButton` ä½¿ç”¨ `HitTestBehavior.opaque` æå‡å‘½ä¸­ç‡

### ğŸ§© å“ç‰Œä¸æ‰“åŒ… (Build)
- å·²åŸºäºæ›´æ–°åçš„ `client/assets/logo.png` é‡æ–°ç”Ÿæˆï¼š
  - `client/windows/runner/resources/app_icon.ico`
- å·²å®Œæˆ Windows Release é‡æ‰“åŒ…ï¼š
  - äº§ç‰©ï¼š`client/build/windows/x64/runner/Release/intelli-note.exe`
- `.gitignore` æ–°å¢ `client/assets/*.psd`ï¼Œé¿å…è®¾è®¡æºæ–‡ä»¶è¯¯æäº¤ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub lib/app/app.dart lib/app/app_state.dart lib/features/settings/settings_page.dart lib/features/chat/chat_page.dart lib/features/home/home_page.dart lib/features/home/interactive_search_bar.dart lib/features/home/modern_menu.dart lib/features/notebook/notebook_page.dart test/app_state_settings_test.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`
- `flutter build windows --release --no-pub`

---

## 2026-02-10 (UX & Theme Polish v4): æœç´¢æ”¶èµ·ä¿®å¤ + æ¥æºå¾½æ ‡åŒ– + å¯é€‰ä¸»é¢˜è‰²

### ğŸ¯ ç›®æ ‡
ä¿®å¤é¦–é¡µæœç´¢æ¡†åœ¨ PC ç«¯çš„æ”¶èµ·ä¸æ¨¡ç³Šè¡Œä¸ºå¼‚å¸¸ï¼Œä¼˜åŒ–æ¥æºæ–‡ä»¶åœ¨æ·±è‰²æ¨¡å¼ä¸‹çš„å¯è¯»æ€§ï¼Œå¹¶æ–°å¢æœ‰é™ä¸»é¢˜è‰²é€‰æ‹©èƒ½åŠ›ï¼ˆé…åˆæµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿï¼‰ã€‚

### â• æ–°å¢ (Added)
- è®¾ç½®é¡µ `å¤–è§‚` å¢åŠ â€œä¸»é¢˜è‰²â€é€‰æ‹©ï¼ˆç¿¡ç¿ ç»¿ã€æµ·æ´‹è“ã€ç´«ç½—å…°ã€ç¥ç€æ©™ã€ç«ç‘°çº¢ï¼‰ã€‚
- `AppState` æ–°å¢ä¸»é¢˜è‰²é…ç½®é“¾è·¯ï¼š
  - æ–°å­—æ®µ `themeAccentId`
  - æ–°æ–¹æ³• `setThemeAccent`
  - æ–°å¢æŒä¹…åŒ–ä¸å›è¯»ï¼ˆ`settings.themeAccentId`ï¼‰
- æ–°å¢è®¾ç½®æµ‹è¯•ç”¨ä¾‹ï¼šæ— æ•ˆä¸»é¢˜è‰²å€¼è‡ªåŠ¨å›é€€é»˜è®¤å€¼ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- é¦–é¡µæœç´¢æ äº¤äº’é‡æ„ï¼š
  - Hover å±•å¼€æ—¶ç«‹å³æ˜¾ç¤ºèƒŒæ™¯æ¨¡ç³Šå±‚ï¼ˆä¸å†ä¾èµ–è¾“å…¥æ¡†èšç„¦ï¼‰
  - PC ç«¯é¼ æ ‡ç§»å‡ºä¸”è¾“å…¥ä¸ºç©ºæ—¶è‡ªåŠ¨æ”¶èµ·
  - ç‚¹å‡»ç©ºç™½åŒºåŸŸæ—¶ï¼Œç©ºè¾“å…¥åœºæ™¯å¯ç«‹å³æ”¶èµ·
  - å›è½¦æäº¤åç»§ç»­ä¿æŒâ€œæ— æ¨¡ç³Šâ€å±•ç¤ºç»“æœ
- é¦–é¡µ Notebook å›¾æ ‡æ ·å¼è°ƒæ•´ï¼š
  - å–æ¶ˆ emoji èƒŒæ™¯å®¹å™¨ï¼Œæ”¹ä¸ºé€æ˜å±•ç¤º
  - emoji å°ºå¯¸å¢å¤§ï¼Œæé«˜è¯†åˆ«åº¦
- æ¥æºæ–‡ä»¶å¡ç‰‡è§†è§‰ä¸ä¿¡æ¯è¡¨è¾¾å‡çº§ï¼š
  - æ–‡ä»¶å‰å¯¼å›¾æ ‡æ”¹ä¸ºæ‰©å±•åå¾½æ ‡ï¼ˆå¦‚ `MD`ã€`PDF`ã€`TXT`ï¼‰
  - æ·±è‰²/æµ…è‰²ä¸‹ç»Ÿä¸€ä½¿ç”¨ä¸»é¢˜è¯­ä¹‰è‰²ï¼Œå¢å¼ºæ ‡é¢˜ã€çŠ¶æ€ä¸èƒŒæ™¯å¯¹æ¯”
  - åˆ é™¤æŒ‰é’®ä¸è¿›åº¦è‰²å½©ç»Ÿä¸€æ¥å…¥ä¸»é¢˜è‰²
- å…¨å±€ä¸»é¢˜æ”¯æŒä¸»é¢˜è‰²é©±åŠ¨ï¼š
  - `MaterialApp` æ ¹æ®è®¾ç½®ä¸»é¢˜è‰²åŠ¨æ€ç”Ÿæˆ light/dark Theme
  - `FilledButton`ã€`FAB`ã€`SegmentedButton`ã€`Chip` ç­‰æ§ä»¶ä¸»è‰²ç»Ÿä¸€è·Ÿéšä¸»é¢˜è‰²
  - èŠå¤©ç”¨æˆ·æ°”æ³¡æ”¹ä¸ºä¸»é¢˜è‰²ä½é€æ˜åº¦é£æ ¼ï¼Œå’Œå‘é€æŒ‰é’®è‰²è°ƒä¿æŒä¸€è‡´

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤æœç´¢æ¡†é¦–æ¬¡ Hover å±•å¼€æ—¶èƒŒæ™¯ä¸æ¨¡ç³Šçš„é—®é¢˜ã€‚
- ä¿®å¤æœç´¢æ¡†åœ¨è¾“å…¥ä¸ºç©ºæ—¶ï¼Œé¼ æ ‡ç§»å‡º/ç‚¹å‡»ç©ºç™½åæ— æ³•æ”¶èµ·çš„é—®é¢˜ã€‚
- ä¿®å¤æ¥æºæ–‡ä»¶åˆ—è¡¨åœ¨æš—è‰²ä¸»é¢˜ä¸‹â€œèƒŒæ™¯ä¸æ–‡å­—åŒºåˆ†åº¦ä¸è¶³â€çš„å¯è¯»æ€§é—®é¢˜ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- è®¾ç½®é“¾è·¯ä»â€œä»…ä¸»é¢˜æ¨¡å¼â€å‡çº§ä¸ºâ€œä¸»é¢˜æ¨¡å¼ + ä¸»é¢˜è‰²â€åŒç»´åº¦é…ç½®ï¼š
  - `SettingsPage` â†’ `AppState` â†’ `PersistenceService(extra.settings)` â†’ å¯åŠ¨ `_load()` å›è¯» â†’ `MaterialApp Theme` åŠ¨æ€æ¶ˆè´¹ã€‚
- æ¥æºæ–‡ä»¶å±•ç¤ºä»â€œç±»å‹å›¾æ ‡â€å‡çº§ä¸ºâ€œæ–‡ä»¶æ‰©å±•åå¾½æ ‡â€ï¼Œä¿¡æ¯è¡¨è¾¾æ›´è´´è¿‘æ–‡ä»¶è¯­ä¹‰ï¼Œä¸”ä¸ä¾èµ–å›¾æ ‡æ˜ å°„ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub lib/app/app.dart lib/app/app_state.dart lib/features/home/interactive_search_bar.dart lib/features/home/home_page.dart lib/features/sources/sources_page.dart lib/features/settings/settings_page.dart lib/features/chat/chat_page.dart test/app_state_settings_test.dart`
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart`

---

## 2026-02-10 (Theme UX Hotfix v2): ChatGPT é£æ ¼æš—è‰²ä¼˜åŒ– + æœç´¢äº¤äº’é‡æ„

### ğŸ¯ ç›®æ ‡
é’ˆå¯¹è§†è§‰åé¦ˆç»§ç»­ä¼˜åŒ–æ·±è‰²æ¨¡å¼ï¼ˆå‚è€ƒ ChatGPT Android é£æ ¼ï¼‰ï¼Œé™ä½å›¾æ ‡èƒŒæ™¯ä¸å¡ç‰‡é˜´å½±å‹è¿«æ„Ÿï¼›åŒæ—¶é‡æ„é¦–é¡µæœç´¢æ¡†äº¤äº’é€»è¾‘ï¼Œè§£å†³ PC æ‚¬åœä¸æäº¤è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸçš„é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- æ·±è‰²ä¸»é¢˜æ”¹ä¸ºæ›´æ¥è¿‘ ChatGPT é£æ ¼çš„ä¸­æ€§æ·±ç°åŸºè°ƒï¼š
  - èƒŒæ™¯/é¢æ¿/è¾¹æ¡†è‰²é‡‡ç”¨æ›´å…‹åˆ¶çš„å±‚çº§å¯¹æ¯”ï¼ˆéé«˜é¥±å’Œè‰²å—ï¼‰
  - ä¿ç•™å‘é€æŒ‰é’®ä¸»è‰²ä½œä¸ºå“ç‰Œå¼ºè°ƒè‰²ï¼Œç»Ÿä¸€äº¤äº’ç„¦ç‚¹
- é¦–é¡µä¸èœå•é˜´å½±å‡è½»ï¼š
  - Notebook å¡ç‰‡ã€æ‚¬æµ®æœç´¢æ¡†ã€ä¸‹æ‹‰èœå•ã€é‡å‘½åå¼¹çª—é˜´å½±åŠå¾„ä¸é€æ˜åº¦æ•´ä½“ä¸‹è°ƒ
  - å›¾æ ‡èƒŒæ™¯ä¸å®¹å™¨å¯¹æ¯”åº¦é™ä½ï¼Œé¿å…â€œå‘ç°å‘è„â€æˆ–â€œé‡é˜´å½±â€è§†è§‰è´Ÿæ‹…
- Chat é¡µé¢æš—è‰²è¿›ä¸€æ­¥é€‚é…ï¼š
  - ç”¨æˆ·æ°”æ³¡æ”¹ä¸ºæ›´ä¸­æ€§çš„æ·±ç°æ ·å¼ï¼ˆæš—è‰²ä¸‹ä¸å†åçªå…€ï¼‰
  - Markdown æ–‡æœ¬/ä»£ç å—/è¾“å…¥åŒºæ–‡å­—ä¸æç¤ºè‰²æ”¹ä¸ºä¸»é¢˜è¯­ä¹‰è‰²
  - è¾“å…¥æ¡†å®¹å™¨ä¸å¿™ç¢Œæ€æŒ‰é’®é¢œè‰²åœ¨æš—è‰²ä¸‹ç»Ÿä¸€ä¸ºä½å¯¹æ¯”å±‚çº§

### ğŸ” æœç´¢äº¤äº’é‡æ„ (Search UX)
- PC ç«¯é¼ æ ‡ç§»å‡ºæœç´¢æ¡†æ—¶ï¼šè‹¥è¾“å…¥ä¸ºç©ºåˆ™è‡ªåŠ¨æ”¶èµ·ã€‚
- æœç´¢æ”¹ä¸ºâ€œå›è½¦æäº¤â€è§¦å‘æ£€ç´¢ï¼š
  - è¾“å…¥è¿‡ç¨‹ä¸­ä¸ç«‹å³ç­›é€‰ï¼ˆæ¸…ç©ºè¾“å…¥æ—¶ä¼šç«‹å³æ¸…ç©ºç­›é€‰ï¼‰
  - æŒ‰ Enter åæäº¤å…³é”®è¯å¹¶å–æ¶ˆèƒŒæ™¯æ¨¡ç³Š
- èƒŒæ™¯æ¨¡ç³Šåªåœ¨â€œå±•å¼€ + æœªæäº¤ + èšç„¦è¾“å…¥â€æ—¶å‡ºç°ï¼Œé¿å…æäº¤åä»é®æŒ¡å†…å®¹ã€‚
- é¦–é¡µç»Ÿè®¡æ–‡æ¡ˆå¢å¼ºï¼š
  - å½“æœ‰ç­›é€‰å…³é”®è¯æ—¶æ˜¾ç¤º  
    `ä½ æœ‰ {æ€»æ•°} ä¸ªç¬”è®°æœ¬ï¼Œæ£€ç´¢å…³é”®è¯ â€œ{å…³é”®è¯}â€ ï¼Œæ£€ç´¢åˆ° {ç»“æœæ•°} ä¸ªç»“æœ`

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æœç´¢çŠ¶æ€ä»â€œçº¯è¾“å…¥è”åŠ¨ç­›é€‰â€å‡çº§ä¸ºâ€œè¾“å…¥æ€ + æäº¤æ€â€åŒçŠ¶æ€æ¨¡å‹ï¼Œäº¤äº’è¯­ä¹‰æ›´æ¸…æ™°ã€‚
- æ·±è‰²ä¸»é¢˜ç»§ç»­ä»â€œç»„ä»¶å±€éƒ¨ä¿®è‰²â€å‘â€œè¯­ä¹‰è‰²ç»Ÿä¸€é©±åŠ¨â€æ¨è¿›ï¼Œä¸ºåç»­ Sources/Studio/Notes é¡µé¢ç»Ÿä¸€æ”¹é€ å¥ å®šåŸºçº¿ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub`ï¼ˆç›¸å…³æ–‡ä»¶ï¼‰é€šè¿‡ã€‚
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart` é€šè¿‡ã€‚

---

## 2026-02-10 (Theme UX Hotfix): è®¾ç½®æŒ‰é’®é¿è®© + VSC é£æ ¼æ·±è‰²ä¸»é¢˜ä¼˜åŒ–

### ğŸ¯ ç›®æ ‡
ä¿®å¤é¦–é¡µæœç´¢æ ä¸è®¾ç½®æŒ‰é’®é‡å é—®é¢˜ï¼Œå¹¶å°†æ·±è‰²æ¨¡å¼è°ƒæ•´ä¸ºæ›´æ¥è¿‘ VS Code é»˜è®¤ Dark Theme çš„è§†è§‰é£æ ¼ï¼Œæå‡ç»„ä»¶åœ¨æš—è‰²åœºæ™¯ä¸‹çš„å¯è¯»æ€§ä¸ä¸€è‡´æ€§ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- æœç´¢æ å®šä½æ”¯æŒåç§»å‚æ•°ï¼ˆ`topOffset`ã€`rightOffset`ï¼‰ï¼Œé¦–é¡µå°†æœç´¢æ å³ä¾§ç•™ç™½åç§»ï¼Œé¿å…ä¸é½¿è½®æŒ‰é’®é‡å ã€‚
- å…¨å±€ä¸»é¢˜é‡æ„ä¸ºåŒæ–¹æ¡ˆå¼ï¼š
  - æµ…è‰²ï¼šå»¶ç»­ç°æœ‰é£æ ¼
  - æ·±è‰²ï¼šé‡‡ç”¨ VSC é£æ ¼é…è‰²ï¼ˆæ·±ç°èƒŒæ™¯ + ä¸­æ€§é¢æ¿ + è“è‰²å¼ºè°ƒï¼‰
- å¼ºåŒ–æš—è‰²ä¸»é¢˜åŸºç¡€æ ·å¼ï¼š`scaffoldBackgroundColor`ã€`cardTheme`ã€`dialogTheme`ã€`inputDecorationTheme`ã€`appBar` å›¾æ ‡ä¸æ–‡æœ¬é¢œè‰²ç»Ÿä¸€ã€‚
- é¦–é¡µå…³é”®ç»„ä»¶å»ç¡¬ç¼–ç äº®è‰²ï¼š
  - ç©ºæ€æ–‡æ¡ˆã€å¡ç‰‡èƒŒæ™¯ã€å¡ç‰‡è¾¹æ¡†ã€æ ‡é¢˜ä¸æ›´å¤šæŒ‰é’®å›¾æ ‡æ”¹ä¸ºåŸºäº `ColorScheme` çš„åŠ¨æ€é¢œè‰²
  - æ–°å»º/é‡å‘½åå¼¹çª—åœ¨æš—è‰²ä¸‹ä½¿ç”¨æ·±è‰²æ¸å˜ä¸åŠ¨æ€è¾¹æ¡†/æ–‡æœ¬è‰²
- èœå•ä¸æœç´¢ç»„ä»¶æš—è‰²é€‚é…ï¼š
  - `ModernMenu` çš„èƒŒæ™¯ã€è¾¹æ¡†ã€é˜´å½±ã€hover ä¸æ–‡æœ¬è‰²æ”¹ä¸ºä¸»é¢˜é©±åŠ¨
  - `InteractiveSearchBar` çš„èƒŒæ™¯ã€è¾¹æ¡†ã€å›¾æ ‡è‰²ã€è¾“å…¥æ–‡å­—è‰²æ”¹ä¸ºä¸»é¢˜é©±åŠ¨ï¼Œå¹¶ç§»é™¤å¼ƒç”¨ API `withOpacity`
- Chat é¡µé¢å…³é”®åŒºåŸŸæš—è‰²é€‚é…ï¼š
  - æ¶ˆæ¯æ°”æ³¡ã€Markdown ä»£ç å—ã€åŠ¨ä½œæŒ‰é’®ã€è¾“å…¥æ¡†æç¤º/æ–‡æœ¬è‰²ã€å‘é€æŒ‰é’®ä¸å¿™ç¢Œæ€é¢œè‰²æ”¹ä¸ºä¸»é¢˜é©±åŠ¨
  - é¿å…æš—è‰²æ¨¡å¼ä¸‹â€œæµ…åº•æ·±å­—â€ä¸â€œå¯¹æ¯”ä¸è¶³â€æ··ç”¨é—®é¢˜

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤é¦–é¡µæœç´¢æ ä¸è®¾ç½®æŒ‰é’®ç‚¹å‡»åŒºåŸŸé‡å ã€‚
- ä¿®å¤æ·±è‰²æ¨¡å¼ä¸‹å¤šä¸ªç»„ä»¶â€œèƒŒæ™¯è¿‡äº®/å­—è‰²åæµ…æˆ–åæš—â€çš„å¯è¯»æ€§é—®é¢˜ã€‚
- æ¸…ç†æœç´¢æ æ— ç”¨çŠ¶æ€å­—æ®µï¼Œæ¶ˆé™¤é™æ€æ£€æŸ¥å‘Šè­¦ã€‚

### âœ… éªŒè¯ (Validation)
- `flutter analyze --no-pub`ï¼ˆç›¸å…³æ–‡ä»¶ï¼‰é€šè¿‡ã€‚
- `flutter test --no-pub test/app_state_settings_test.dart test/widget_test.dart` é€šè¿‡ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- é¡µé¢å±‚ UI é¢œè‰²ç­–ç•¥è¿›ä¸€æ­¥ä»â€œå¸¸é‡è‰²å€¼â€è½¬å‘â€œä¸»é¢˜è¯­ä¹‰è‰²â€ã€‚
- ä¸ºåç»­æ‰©å±•æš—è‰²è¦†ç›–ï¼ˆChat/Sources ç­‰é¡µï¼‰å»ºç«‹ç»Ÿä¸€é…è‰²åŸºçº¿ã€‚

---

## 2026-02-10 (Settings): é¦–é¡µè®¾ç½®å…¥å£ + å¸¸è§„è®¾ç½®é¡µé¦–ç‰ˆ

### ğŸ¯ ç›®æ ‡
åœ¨é¦–é¡µæä¾›å¯å‘ç°çš„è®¾ç½®å…¥å£ï¼Œè½åœ°å¸¸è§„è®¾ç½®é¡µæ ¸å¿ƒèƒ½åŠ›ï¼Œå¹¶ç¡®ä¿è®¾ç½®é¡¹å¯æŒä¹…åŒ–ã€å¯å›è¯»ã€å¯å³æ—¶ç”Ÿæ•ˆã€‚

### â• æ–°å¢ (Added)
- æ–°å¢è®¾ç½®é¡µé¢ `client/lib/features/settings/settings_page.dart`ï¼Œé¦–ç‰ˆæä¾›ï¼š
  - ä¸»é¢˜æ¨¡å¼ï¼šè·Ÿéšç³»ç»Ÿ / æµ…è‰² / æ·±è‰²
  - é¦–é¡µç§°å‘¼ï¼šå¯ç¼–è¾‘å¹¶ä¿å­˜ï¼ˆå«é•¿åº¦ä¸ç©ºç™½è¾“å…¥æ ¡éªŒï¼‰
  - åˆ é™¤ Notebook å‰äºŒæ¬¡ç¡®è®¤å¼€å…³
  - é¦–é¡µç¬”è®°æœ¬æ•°é‡æ˜¾ç¤ºå¼€å…³
  - â€œè§„åˆ’ä¸­â€åŠŸèƒ½ä½ï¼šè¯­è¨€ã€å¿«æ·é”®ã€å¯åŠ¨è¡Œä¸º
- æ–°å¢è®¾ç½®å›å½’æµ‹è¯• `client/test/app_state_settings_test.dart`ï¼š
  - é»˜è®¤å€¼æ£€æŸ¥
  - æŒä¹…åŒ–å†™å…¥ä¸é‡è½½æ¢å¤
  - ç§°å‘¼ç©ºç™½å›é€€ä¸è¶…é•¿æˆªæ–­

### ğŸ› ï¸ å˜æ›´ (Changed)
- `AppState` å¢åŠ è®¾ç½®çŠ¶æ€ä¸æŒä¹…åŒ–é“¾è·¯ï¼š
  - æ–°å¢å­—æ®µï¼š`themeMode`ã€`displayName`ã€`confirmBeforeDeleteNotebook`ã€`showNotebookCount`
  - `_save()` æ‰©å±•å†™å…¥ `settings` èŠ‚ç‚¹ï¼Œ`_load()` æ”¯æŒå›è¯»å¹¶å®¹é”™é»˜è®¤å€¼
  - æ–°å¢è®¾ç½®æ›´æ–°æ–¹æ³•ï¼š`setThemeMode`ã€`setDisplayName`ã€`setConfirmBeforeDeleteNotebook`ã€`setShowNotebookCount`
- `MaterialApp` æ”¹ä¸ºè·Ÿéš `AppState` çš„ `themeMode`ï¼Œå¹¶è¡¥å…… `darkTheme` ä¸»é¢˜ã€‚
- é¦–é¡µ `SliverAppBar` æ–°å¢é½¿è½®æŒ‰é’®ï¼Œç‚¹å‡»è¿›å…¥è®¾ç½®é¡µã€‚
- é¦–é¡µé—®å€™è¯­ä»å›ºå®š `Eddy` æ”¹ä¸ºè¯»å–è®¾ç½®ç§°å‘¼ï¼›ç¬”è®°æœ¬æ•°é‡æ–‡æœ¬æ”¯æŒå¼€å…³æ§åˆ¶ã€‚
- Notebook åˆ é™¤å…¥å£æ¥å…¥â€œäºŒæ¬¡ç¡®è®¤â€é…ç½®ï¼ˆå…³é—­æ—¶å¯ç›´æ¥åˆ é™¤ï¼Œå¼€å¯æ—¶å¼¹ç¡®è®¤å¯¹è¯æ¡†ï¼‰ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤è®¾ç½®é¡µè¾“å…¥æ ¼å¼å™¨å£°æ˜å¯¼è‡´çš„æµ‹è¯•ç¼–è¯‘é”™è¯¯ï¼ˆ`const` åˆ—è¡¨ä¸­ä½¿ç”¨éå¸¸é‡æ„é€ ï¼‰ã€‚
- æ¸…ç† `app_state.dart` å†—ä½™å¯¼å…¥ï¼Œæ¶ˆé™¤é™æ€åˆ†æå‘Šè­¦ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- è®¾ç½®æ•°æ®é“¾è·¯å·²é—­ç¯ï¼š`è®¾ç½®é¡µè¾“å…¥` â†’ `AppState` çŠ¶æ€æ›´æ–°/å½’ä¸€åŒ– â†’ `PersistenceService.saveData(extra.settings)` â†’ å¯åŠ¨æ—¶ `_load()` å›è¯» â†’ `MaterialApp/HomePage` å®æ—¶æ¶ˆè´¹ã€‚
- è¯¥é“¾è·¯ä¸ç°æœ‰ `selectedSources` å…±å­˜äºåŒä¸€æŒä¹…åŒ–æ–‡ä»¶ï¼Œä¸ç ´åæ—¢æœ‰ Notebook/Sources/Chat/Notes æ•°æ®ç»“æ„ã€‚

---

## 2026-02-10 (Windows Build Hotfix): ç›®æ ‡é‡å‘½ååçš„ CMake ç¼“å­˜å…¼å®¹

### ğŸ¯ ç›®æ ‡
ä¿®å¤ Windows ç«¯åœ¨åº”ç”¨ç›®æ ‡åé‡å‘½ååï¼Œ`flutter run -d windows` å› å†å² CMake ç¼“å­˜ä»å¼•ç”¨æ—§ç›®æ ‡ `intellinote` è€Œæ„å»ºå¤±è´¥çš„é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- åœ¨ `client/windows/CMakeLists.txt` å¢åŠ å®‰è£…å‰ç¼€ç¼“å­˜è¿ç§»é€»è¾‘ï¼š
  - å½“æ£€æµ‹åˆ° `CMAKE_INSTALL_PREFIX` å«æœ‰ `TARGET_FILE_DIR:` çš„å†å²ç›®æ ‡è¡¨è¾¾å¼æ—¶ï¼Œå¼ºåˆ¶é‡ç½®ä¸ºå½“å‰ `BINARY_NAME` å¯¹åº”è·¯å¾„ã€‚
  - ä¿ç•™é»˜è®¤åˆå§‹åŒ–åˆ†æ”¯ï¼Œç»§ç»­å…¼å®¹é¦–æ¬¡é…ç½®æµç¨‹ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ `CMake Error: $<TARGET_FILE_DIR:intellinote> No target "intellinote"` å¯¼è‡´çš„ç”Ÿæˆé˜¶æ®µå¤±è´¥ã€‚
- éªŒè¯ç»“æœï¼š`flutter run -d windows --no-pub` å¯æ­£å¸¸æ„å»ºå¹¶å¯åŠ¨ï¼Œäº§ç‰©ä¸º `build/windows/x64/runner/Debug/intelli-note.exe`ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- Windows æ„å»ºé“¾å¯¹â€œç›®æ ‡åå˜æ›´â€å…·å¤‡å‘åå…¼å®¹èƒ½åŠ›ï¼Œå‡å°‘ `flutter clean`/æ‰‹åŠ¨åˆ ç¼“å­˜çš„å¼ºä¾èµ–ã€‚

### ğŸ” é¢å¤–æ’æŸ¥ (Investigation)
- å¯¹ `client/assets/logo.png` æ‰§è¡Œæ— å…ƒæ•°æ®é‡å†™ï¼Œå¹¶åŒæ­¥é‡å»º `client/windows/runner/resources/app_icon.ico`ï¼Œç¡®ä¿å›¾æ ‡æºæ–‡ä»¶ä»…å«åŸºç¡€ PNG å—ã€‚
- åœ¨ `flutter clean` åé‡æ–°æ‰§è¡Œ `flutter run -d windows`ï¼Œæ„å»ºå¯æˆåŠŸå®Œæˆï¼Œä½† `libpng iCCP` è­¦å‘Šä»å‡ºç°ï¼Œè¯´æ˜è¯¥è­¦å‘Šä¸ç”±å½“å‰é¡¹ç›® Logo èµ„æºç›´æ¥è§¦å‘ã€‚

---

## 2026-02-10 (Branding v2): å†…éƒ¨æŠ€æœ¯æ ‡è¯†æŒ‰å‘½åçº¦æŸç»Ÿä¸€

### ğŸ¯ ç›®æ ‡
åœ¨â€œç»Ÿä¸€å“ç‰Œä¸º `Intelli Note`â€çš„åŸºç¡€ä¸Šï¼Œå¯¹ä¸æ”¯æŒç©ºæ ¼çš„æŠ€æœ¯æ ‡è¯†æ‰§è¡Œé™çº§å‘½åï¼šä¼˜å…ˆ `Intelli-Note`ï¼Œè‹¥ä»ä¸æ”¯æŒåˆ™ä½¿ç”¨ `Intelli_Note`ï¼ˆæŒ‰å„ç”Ÿæ€è§„èŒƒè½¬ä¸ºå°å†™ï¼‰ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- Flutter åŒ…åä» `intellinote` è°ƒæ•´ä¸º `intelli_note`ï¼ˆDart åŒ…åä¸æ”¯æŒç©ºæ ¼ä¸è¿å­—ç¬¦ï¼‰ï¼š
  - `client/pubspec.yaml`
  - `client/test/widget_test.dart` çš„ `package:` å¯¼å…¥åŒæ­¥æ›´æ–°ã€‚
- Windows æ„å»ºæ ‡è¯†æŒ‰çº¦æŸæ‹†åˆ†ï¼š
  - `project()` åç§°æ”¹ä¸º `intelli_note`ï¼ˆç¨³å¦¥å…¼å®¹ CMake å˜é‡ä½“ç³»ï¼‰ã€‚
  - å¯æ‰§è¡Œäº§ç‰©åæ”¹ä¸º `intelli-note`ï¼ˆæ”¯æŒè¿å­—ç¬¦ï¼‰ã€‚
  - `Runner.rc` ä¸­ `OriginalFilename` åŒæ­¥ä¸º `intelli-note.exe`ã€‚
- Docker éƒ¨ç½²æ ‡è¯†ç»Ÿä¸€ä¸ºè¿å­—ç¬¦é£æ ¼ï¼š
  - å®¹å™¨åï¼š`intelli-note-redis` / `intelli-note-api` / `intelli-note-worker`
  - ç½‘ç»œåï¼š`intelli-note-net`
- Celery åº”ç”¨åè°ƒæ•´ä¸º `intelli-note-worker`ï¼Œä¸éƒ¨ç½²å‘½åä¸€è‡´ã€‚

### â• æ–°å¢ (Added)
- æŒä¹…åŒ–æ–‡ä»¶å‘½åå‡çº§ä¸º `Intelli Note_data.json`ï¼Œå¹¶æ–°å¢æ—§æ–‡ä»¶åå…¼å®¹å›é€€è¯»å–ï¼š
  - `intellinote_data.json`
  - `intelli-note_data.json`
  - `intelli_note_data.json`
- `.gitignore` æ–°å¢ `client/intelli_note.iml` ä¸ `client/intelli-note.iml`ï¼Œå…¼å®¹ IDE æ¨¡å—åå˜åŒ–ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤åŒ…åæ”¹åŠ¨åæµ‹è¯•æ–‡ä»¶å†—ä½™å¯¼å…¥å¯¼è‡´çš„é™æ€æ£€æŸ¥å‘Šè­¦ï¼ˆ`unused_import`ï¼‰ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å“ç‰Œå±•ç¤ºå±‚ä¿æŒ `Intelli Note`ï¼ˆç©ºæ ¼å½¢å¼ï¼‰ï¼ŒæŠ€æœ¯æ ‡è¯†å±‚æ ¹æ®å·¥å…·é“¾çº¦æŸè‡ªåŠ¨é™çº§ä¸º `-` æˆ– `_`ï¼Œé¿å…â€œå“ç‰Œç»Ÿä¸€â€ä¸â€œæ„å»ºå¯ç”¨æ€§â€å†²çªã€‚
- æœ¬æ¬¡å¯¹æŒä¹…åŒ–è·¯å¾„åŠ å…¥å…¼å®¹åŠ è½½é“¾è·¯ï¼Œé¿å…å†å²ç”¨æˆ·æ•°æ®å› æ–‡ä»¶åè¿ç§»è€Œä¸¢å¤±ã€‚

---

## 2026-02-10 (Branding): ç»Ÿä¸€å“ç‰Œä¸º Intelli Note å¹¶æ¥å…¥ LOGO

### ğŸ¯ ç›®æ ‡
å°† `client/assets/logo.png` ç»Ÿä¸€åº”ç”¨åˆ°ç¨‹åºå›¾æ ‡ã€æ ‡é¢˜æ ä¸æ–‡æ¡£å“ç‰Œä½ï¼Œå¹¶å°†å¯¹å¤–å±•ç¤ºåç§°ç»Ÿä¸€ä¸º `Intelli Note`ã€‚

### â• æ–°å¢ (Added)
- å®¢æˆ·ç«¯é¦–é¡µæ ‡é¢˜æ æ–°å¢å“ç‰Œ Logoï¼ˆ`assets/logo.png`ï¼‰ï¼Œä¸ `Intelli Note` æ–‡æ¡ˆå¹¶åˆ—å±•ç¤ºã€‚
- `README.md` ä¸ `client/README.md` æ–°å¢ Logo å±•ç¤ºä½ï¼Œç»Ÿä¸€é¡¹ç›®è§†è§‰å…¥å£ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- Windows ç¨‹åºçª—å£æ ‡é¢˜æ”¹ä¸º `Intelli Note`ï¼ˆ`client/windows/runner/main.cpp`ï¼‰ã€‚
- Windows å¯æ‰§è¡Œæ–‡ä»¶èµ„æºå…ƒä¿¡æ¯ï¼ˆ`FileDescription`/`InternalName`/`ProductName`ï¼‰ç»Ÿä¸€ä¸º `Intelli Note`ï¼ˆ`client/windows/runner/Runner.rc`ï¼‰ã€‚
- åç«¯å¯¹å¤–é¡¹ç›®åæ”¹ä¸º `Intelli Note Server`ï¼ˆ`server/app/core/config.py`ï¼‰ã€‚
- èŠå¤©æç¤ºè¯æ¨¡æ¿ä¸­çš„åŠ©æ‰‹èº«ä»½ä» `IntelliNote` ç»Ÿä¸€ä¸º `Intelli Note`ï¼ˆ`server/app/templates/chat/*.md`ï¼‰ã€‚
- å¯åŠ¨è„šæœ¬çª—å£æ ‡é¢˜ä¸å¯åŠ¨æç¤ºæ–‡æ¡ˆç»Ÿä¸€ä¸º `Intelli Note`ï¼ˆ`start_dev.bat`ï¼‰ã€‚
- å®¢æˆ·ç«¯å·¥ä½œæµæ–‡æ¡£æ ‡é¢˜ä¸å“ç‰Œç§°å‘¼ç»Ÿä¸€ä¸º `Intelli Note`ï¼ˆ`client/IntelliNote_Build_Workflow.md`ï¼‰ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ `client/lib/app/app.dart` ä¸­ `withOpacity` çš„å¼ƒç”¨è°ƒç”¨ï¼Œæ”¹ä¸º `withValues(alpha: 0.1)`ï¼Œæ¶ˆé™¤é™æ€åˆ†æå‘Šè­¦ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ä¿æŒæŠ€æœ¯æ ‡è¯†ï¼ˆå¦‚åŒ…åã€å¯æ‰§è¡Œæ–‡ä»¶åã€å®¹å™¨åï¼‰ä¸å˜ï¼Œä»…ç»Ÿä¸€ç”¨æˆ·å¯è§å“ç‰Œå±‚ï¼Œé¿å…ç ´åä¾èµ–é“¾ä¸éƒ¨ç½²è„šæœ¬å…¼å®¹æ€§ã€‚
- Windows å›¾æ ‡èµ„æº `client/windows/runner/resources/app_icon.ico` ç”± `client/assets/logo.png` é‡æ–°ç”Ÿæˆï¼Œå½¢æˆâ€œå•ä¸€å“ç‰Œæºå›¾â€åˆ°ç¨‹åºå›¾æ ‡çš„å¯è¿½æº¯é“¾è·¯ã€‚

---

## 2026-02-10 (Audit): ä»£ç åº“å…¨é‡å®¡æŸ¥ä¸é—®é¢˜æ•´åˆ

### ğŸ¯ ç›®æ ‡
æ•´åˆ Codex Cloud çš„å››ä»½ä»£ç å®¡æŸ¥æŠ¥å‘Šï¼Œè¾“å‡ºç»Ÿä¸€çš„ã€Šä»£ç å®¡æŸ¥ä¸å®¡è®¡æŠ¥å‘Šã€‹ï¼Œå¹¶è¯†åˆ«æ ¸å¿ƒé£é™©ç‚¹ä¸æŠ€æœ¯å€ºåŠ¡ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **æŠ¥å‘Šæ•´åˆ**: å°† `NeedCleared.å®¡æŸ¥æŠ¥å‘Š.txt` ä¸­çš„ UIã€APIã€æµ‹è¯•ä¸‰ä¸ªç»´åº¦çš„ 4 ä¸ªç‰ˆæœ¬æŠ¥å‘Šæ•´åˆä¸º `Consolidated_Review_Report.md`ã€‚
- **é£é™©åˆ†çº§**: è¯†åˆ«å‡º 3 ä¸ª P0 çº§è‡´å‘½ç¼ºé™·ï¼ˆå´©æºƒ/ç¼–è¯‘é”™è¯¯/è¾“å…¥å†²çªï¼‰ã€3 ä¸ª P1 çº§ä½“éªŒç¼ºé™·ï¼ˆæµå¼è¶…æ—¶/åé¦ˆç¼ºå¤±ï¼‰ä»¥åŠæ¶æ„çº§ P2 å€ºåŠ¡ã€‚
- **æ–‡æ¡£ç»´æŠ¤**: åˆ é™¤åŸå§‹å†—ä½™æŠ¥å‘Šæ–‡ä»¶ `NeedCleared.å®¡æŸ¥æŠ¥å‘Š.txt`ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æœ¬æ¬¡è¡ŒåŠ¨ä¸ºçº¯æ–‡æ¡£ä¸å®¡è®¡å·¥ä½œï¼Œæœªç›´æ¥ä¿®æ”¹ä»£ç ï¼Œä½†ä¸ºåç»­çš„â€œç¨³å®šæ€§åŠ å›ºâ€é˜¶æ®µç¡®ç«‹äº†æ˜ç¡®çš„ä¿®å¤è·¯çº¿å›¾ã€‚

---

## 2026-02-10 (UX Hotfix v3): å¼ºåˆ¶æ‰‹åŠ¨æ»šåŠ¨ä¼˜å…ˆ + è¾“å…¥æ¡†å•è¡Œç©ºæ€ç˜¦èº«

### ğŸ¯ ç›®æ ‡
å½»åº•è§£å†³ç”¨æˆ·æ‰‹åŠ¨æ»šåŠ¨æ—¶ä»è¢«è‡ªåŠ¨è·Ÿéšå¹²æ‰°çš„é—®é¢˜ï¼Œå¹¶ç»§ç»­å‹ç¼©è¾“å…¥æ¡†åœ¨ç©ºå†…å®¹/å•è¡Œåœºæ™¯ä¸‹çš„è§†è§‰é«˜åº¦ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- å¯¹è¯æ»šåŠ¨æ–°å¢æ›´å¼ºçº¦æŸï¼š
  - æ‰‹åŠ¨äº¤äº’æœŸé—´ï¼ˆæ‹–æ‹½/æ»šè½®ï¼‰ç¦æ­¢ `_scrollToBottom` æ‰§è¡Œï¼›
  - ä»…åœ¨ç”¨æˆ·å›åˆ°åº•éƒ¨æ—¶æ¢å¤è‡ªåŠ¨è·Ÿéšã€‚
- è¾“å…¥æ¡†å•è¡Œç©ºæ€è‡ªé€‚åº”ï¼š
  - å®¹å™¨å‚ç›´å†…è¾¹è·ã€æœ€å°é«˜åº¦ã€æ–‡æœ¬å­—å·ä¸è¡Œé«˜ä¸‹è°ƒï¼›
  - å‘é€æŒ‰é’®å°ºå¯¸å’Œå›¾æ ‡å°ºå¯¸è”åŠ¨ç¼©å°ï¼›
  - å¤šè¡Œæ—¶è‡ªåŠ¨å›åˆ°æ›´å®½æ¾çš„é˜…è¯»æ¯”ä¾‹ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤æ»šåŠ¨æ—¶è‡ªåŠ¨è·Ÿéšä¸æ‰‹åŠ¨æ»šåŠ¨äº‰æŠ¢å¯¼è‡´çš„â€œåå¤æ¨ªè·³â€ã€‚
- ä¿®å¤ç©ºå†…å®¹è¾“å…¥æ¡†çœ‹èµ·æ¥è¿‡åšã€å­—ä½“ä¸æŒ‰é’®æ¯”ä¾‹ä¸åè°ƒçš„é—®é¢˜ã€‚

---

## 2026-02-10 (UX Hotfix v2): å¯¹è¯æ»šåŠ¨é”å®šæœºåˆ¶ + è¾“å…¥æ¡†ç©ºæ€æ¯”ä¾‹ä¿®æ­£

### ğŸ¯ ç›®æ ‡
è§£å†³å¯¹è¯åŒºæ»šåŠ¨åœ¨ç”¨æˆ·åŒ€é€Ÿæ‹–åŠ¨æ—¶ä»å‡ºç°è·³åŠ¨çš„é—®é¢˜ï¼Œå¹¶ä¿®æ­£è¾“å…¥æ¡†åœ¨ç©ºå†…å®¹çŠ¶æ€ä¸‹çš„å­—ä½“ä¸å®¹å™¨æ¯”ä¾‹å¤±è¡¡ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- èŠå¤©æ»šåŠ¨æ–°å¢â€œæ‰‹åŠ¨æ»šåŠ¨é”â€ï¼ˆ`_manualScrollHold`ï¼‰ï¼š
  - ç”¨æˆ·æ»šåŠ¨/æ»šè½®æœŸé—´å¼ºåˆ¶å…³é—­è‡ªåŠ¨è·Ÿéšï¼›
  - ä»…åœ¨ç”¨æˆ·ç»“æŸäº¤äº’ä¸”æ¥è¿‘åº•éƒ¨æ—¶æ¢å¤è‡ªåŠ¨æ»šåŠ¨ã€‚
- è‡ªåŠ¨æ»šåº•ç­–ç•¥å¢åŠ ä¿æŠ¤ï¼š
  - å½“æ‰‹åŠ¨æ»šåŠ¨é”å¼€å¯æ—¶ï¼Œä¸æ‰§è¡Œè‡ªåŠ¨æ»šåº•ï¼›
  - å°ä½ç§»ç›´æ¥ `jumpTo`ï¼Œå¤§ä½ç§»çŸ­åŠ¨ç”»ï¼Œå‡å°‘æŠ–åŠ¨ã€‚
- è¾“å…¥æ¡†ç©ºæ€æ¯”ä¾‹äºŒæ¬¡ä¿®æ­£ï¼š
  - å®¹å™¨è¾¹è·ã€åœ†è§’å’Œæœ€å°é«˜åº¦ä¸‹è°ƒï¼›
  - æ–‡æœ¬å­—å·/è¡Œé«˜/å†…è¾¹è·é‡é…ï¼›
  - å‘é€æŒ‰é’®å°ºå¯¸ä¸å›¾æ ‡å°ºå¯¸åŒæ­¥ç¼©å°ï¼Œæ¯”ä¾‹æ›´åè°ƒã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œç”¨æˆ·æ­£åœ¨æ»šåŠ¨æ—¶è‡ªåŠ¨è·Ÿéšä»ä»‹å…¥â€å¯¼è‡´çš„ä¸Šè¹¿ä¸‹è·³ã€‚
- ä¿®å¤è¾“å…¥æ¡†ç©ºæ€ä¸‹å­—ä½“è§†è§‰åå¤§ã€æŒ‰é’®ä¸æ–‡æœ¬åŒºæ¯”ä¾‹ä¸åè°ƒã€‚

---

## 2026-02-10 (UX Hotfix): å¯¹è¯æ»šåŠ¨æŠ–åŠ¨ä¿®æ­£ + è¾“å…¥æ¡†æ¯”ä¾‹äºŒæ¬¡è°ƒä¼˜

### ğŸ¯ ç›®æ ‡
ä¿®å¤å¯¹è¯åŒºæ»šåŠ¨æ—¶â€œä¸Šè¹¿ä¸‹è·³â€çš„è·Ÿæ‰‹é—®é¢˜ï¼Œå¹¶è¿›ä¸€æ­¥ä¼˜åŒ–è¾“å…¥æ¡†å­—ä½“ä¸å®¹å™¨å°ºå¯¸æ¯”ä¾‹ä¸åè°ƒçš„é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- å¯¹è¯æ»šåŠ¨è·Ÿéšç­–ç•¥æ”¹ä¸ºâ€œæ‹–æ‹½å¼€å§‹å³å…³é—­è‡ªåŠ¨æ»šåŠ¨ã€æ‹–æ‹½ç»“æŸä¸”æ¥è¿‘åº•éƒ¨æ‰æ¢å¤â€ï¼Œå‡å°‘æ»šåŠ¨å†²çªã€‚
- `_scrollToBottom` å¢åŠ è·ç¦»é˜ˆå€¼ï¼š
  - å°è·ç¦»ç›´æ¥ `jumpTo`
  - å¤§è·ç¦»çŸ­åŠ¨ç”» `animateTo`
  ä»¥é¿å…é¢‘ç¹åŠ¨ç”»å åŠ å¯¼è‡´çš„æŠ–åŠ¨ã€‚
- è¾“å…¥æ¡†å®¹å™¨æ¯”ä¾‹äºŒæ¬¡è°ƒæ•´ï¼š
  - æ–‡æœ¬åŒºæœ€å°é«˜åº¦çº¦æŸ
  - è¾“å…¥å­—å·/è¡Œé«˜ä¸å†…è¾¹è·é‡é…
  - å‘é€æŒ‰é’®å°ºå¯¸çº¦æŸä¸ç¼©æ”¾å¹…åº¦å¾®è°ƒ

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ç”¨æˆ·åŒ€é€Ÿä¸Šä¸‹æ‹–æ‹½æ—¶è‡ªåŠ¨æ»šåŠ¨ä¸ç”¨æˆ·æ»šåŠ¨ç›¸äº’äº‰æŠ¢å¯¼è‡´çš„è·³åŠ¨é—®é¢˜ã€‚
- ä¿®å¤è¾“å…¥æ¡†ä¸­æ–‡æœ¬è§†è§‰æ¯”ä¾‹åå¤§ã€å®¹å™¨é«˜åº¦ä¸åè°ƒçš„é—®é¢˜ã€‚

---

## 2026-02-10 (UX Polish): å¯¹è¯æ»šåŠ¨æ‰‹æ„Ÿä¼˜åŒ– + æ°”æ³¡æ¯”ä¾‹è°ƒæ•´ + æ¥æºå¯¼å…¥çª—å£é‡æ„

### ğŸ¯ ç›®æ ‡
æå‡å¯¹è¯åŒºæ»šåŠ¨è·Ÿæ‰‹æ€§ä¸é˜…è¯»èˆ’é€‚åº¦ï¼Œå¹¶é‡åšâ€œçŸ¥è¯†æ¥æºå¯¼å…¥â€äº¤äº’ï¼Œæ›¿æ¢ç®€é™‹çš„åº•éƒ¨èœå•å¼å…¥å£ã€‚

### âœ¨ æ–°å¢ (Added)
- æ¥æºé¡µæ–°å¢è‡ªå®šä¹‰å¯¼å…¥å¼¹çª—ï¼š
  - `_ImportChooserDialog`ï¼ˆä¸­ç½®å¼¹çª—ï¼Œå¡ç‰‡åŒ–å¯¼å…¥é€‰é¡¹ï¼‰
  - `_ImportActionCard`ï¼ˆå¯äº¤äº’å¯¼å…¥æ–¹å¼å¡ç‰‡ï¼‰
- æ–°å¢ç²˜è´´æ–‡æœ¬å¼¹çª—ï¼š
  - `_PasteSourceDialog`ï¼ˆç»Ÿä¸€ä¸»é¢˜æ ·å¼ï¼‰
  - `_PastePayload`ï¼ˆç²˜è´´å¯¼å…¥å‚æ•°å°è£…ï¼‰
- èŠå¤©é¡µæ–°å¢ `_ChatScrollBehavior`ï¼Œæ‰©å±•é¼ æ ‡/è§¦æ§æ¿æ‹–æ‹½è®¾å¤‡æ”¯æŒã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- å¯¹è¯åŒº `ListView` å¢åŠ æ˜¾å¼ `Scrollbar`ï¼ˆæ¡Œé¢ç«¯ `thumb+track` å¯è§ï¼Œæ”¯æŒæ‹–æ‹½ï¼‰ã€‚
- è‡ªåŠ¨æ»šåŠ¨ç­–ç•¥å¢å¼ºï¼šç”¨æˆ·ä¸»åŠ¨æ»šåŠ¨æ—¶ç«‹å³å…³é—­è‡ªåŠ¨è·Ÿéšï¼Œä»…åœ¨æ¥è¿‘åº•éƒ¨æ—¶æ¢å¤è‡ªåŠ¨æ»šåŠ¨ï¼Œé¿å…â€œæ‹‰æ‰¯æ„Ÿâ€ã€‚
- èŠå¤©æ°”æ³¡å°ºå¯¸ä¸æ’ç‰ˆä¼˜åŒ–ï¼š
  - æœ€å¤§å®½åº¦ä»å›ºå®šæ¯”ä¾‹è°ƒæ•´ä¸ºæ¡Œé¢/ç§»åŠ¨ç«¯åˆ†çº§æ¯”ä¾‹ã€‚
  - è°ƒæ•´æ°”æ³¡å†…è¾¹è·ã€æœ€å°å®½åº¦ã€‚
  - æ­£æ–‡å­—å·ä¸è¡Œé«˜ã€ä»£ç å­—å·ä¸‹è°ƒåˆ°æ›´åè°ƒæ¯”ä¾‹ã€‚
- æ¥æºé¡µå¯¼å…¥å…¥å£ç”± `showModalBottomSheet` æ”¹ä¸º `showGeneralDialog` ä¸­ç½®å¼¹çª—ï¼Œè§†è§‰ä¸äº¤äº’ä¸€è‡´æ€§æå‡ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œå¯¼å…¥æŒ‰é’®ç‚¹å‡»åä»åº•éƒ¨å¼¹å‡ºç®€æ˜“èœå•â€çš„äº¤äº’ç²—ç³™é—®é¢˜ã€‚
- ä¿®å¤ç²˜è´´å¯¼å…¥æ—¶æ–‡æœ¬å†…å®¹ä¸ºç©ºä»å¯æäº¤çš„é—®é¢˜ï¼ˆæ–°å¢å‰ç«¯æ ¡éªŒä¸é”™è¯¯æç¤ºï¼‰ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æ¥æºå¯¼å…¥æµç¨‹ä»â€œé¡µé¢å†…è”åº•éƒ¨èœå• + ç®€å• AlertDialogâ€å‡çº§ä¸ºâ€œå¯å¤ç”¨å¼¹çª—ç»„ä»¶åŒ–æ¶æ„â€ï¼Œåç»­å¯æ‰©å±• URL å¯¼å…¥ã€æ‰¹é‡å¯¼å…¥ç­‰èƒ½åŠ›è€Œæ— éœ€æ”¹åŠ¨ä¸»é¡µé¢ç»“æ„ã€‚

---

## 2026-02-10 (UI Hotfix): Notebook è¾“å…¥çª—å£é‡å†™ + å ä½æç¤ºå†²çªä¿®å¤

### ğŸ¯ ç›®æ ‡
ä¿®å¤è¾“å…¥æ¡†å‡ºç°â€œåŒç°è‰²å ä½æç¤ºâ€çš„ä½“éªŒé—®é¢˜ï¼Œå¹¶å°† Notebook åˆ›å»º/é‡å‘½åå…¥å£é‡å†™ä¸ºç»Ÿä¸€ä¸»é¢˜è¾“å…¥çª—å£ã€‚

### âœ¨ æ–°å¢ (Added)
- æ–°å¢é€šç”¨å¼¹çª—è¾“å…¥èƒ½åŠ›ï¼š
  - `showNotebookNameDialog(...)`
  - `_NotebookNameDialogCard` ç»„ä»¶ï¼ˆå¸¦ç¼©æ”¾æ·¡å…¥åŠ¨ç”»ï¼‰
- æ–°å¢è¾“å…¥çª—å£è§†è§‰ä¸äº¤äº’ï¼š
  - ä¸»é¢˜åŒ–å¡ç‰‡å®¹å™¨ï¼ˆæ¸å˜ã€åœ†è§’ã€èšç„¦è¾¹æ¡†é«˜äº®ï¼‰
  - ç»Ÿä¸€æŒ‰é’®åŒºï¼ˆå–æ¶ˆ/ç¡®è®¤ï¼‰
  - æ ‡é¢˜ç©ºå€¼å³æ—¶é”™è¯¯æç¤º
  - é•¿åº¦é™åˆ¶ï¼ˆ`maxLength=60`ï¼‰

### ğŸ› ï¸ å˜æ›´ (Changed)
- `HomePage._showCreateDialog` æ”¹ä¸ºå¤ç”¨æ–°è¾“å…¥çª—å£ï¼Œä¸å†ä½¿ç”¨ `labelText + hintText` åŒæç¤ºç»„åˆã€‚
- `_NotebookCard._showRenameDialog` å¯¹é½åˆ°åŒä¸€è¾“å…¥çª—å£ï¼Œåˆ›å»ºä¸é‡å‘½åä½“éªŒä¸€è‡´ã€‚
- èŠå¤©è¾“å…¥ç»„ä»¶ç§»é™¤åº•éƒ¨ç¬¬äºŒè¡Œç°è‰²æç¤ºï¼Œä»…ä¿ç•™å•ä¸€å ä½æ–‡æœ¬ï¼Œé¿å…è§†è§‰é‡å¤ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œè¾“å…¥æ¡†ä¸Šä¸‹ä¸¤æ¡ç°è‰²æç¤ºæ–‡å­—â€é—®é¢˜ï¼ˆæ ¹å› ï¼šæ ‡ç­¾ä¸æç¤ºæ–‡æ¡ˆå åŠ ï¼‰ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- Notebook å‘½åè¾“å…¥ä»é¡µé¢å†…è” `AlertDialog+TextField` å‡çº§ä¸ºå¯å¤ç”¨çš„å¯¹è¯è¾“å…¥ç»„ä»¶ï¼Œåç»­å…¶ä»–å‘½ååœºæ™¯å¯ç›´æ¥å¤ç”¨åŒä¸€å®ç°ã€‚

---

## 2026-02-10 (UI Hotfix): å¯¹è¯é¡µçº¢å±ä¿®å¤ + è¾“å…¥æ¡†ç»„ä»¶é‡å†™

### ğŸ¯ ç›®æ ‡
ä¿®å¤èŠå¤©ç•Œé¢å‡ºç° Flutter çº¢åº•é»„å­—é”™è¯¯ï¼Œå¹¶å°†è¾“å…¥æ¡†å‡çº§ä¸ºç¬¦åˆå½“å‰ä¸»é¢˜é£æ ¼çš„åŠ¨ç”»åŒ–ç»„ä»¶ï¼Œæå‡ç¨³å®šæ€§ä¸äº¤äº’è´¨æ„Ÿã€‚

### âœ¨ æ–°å¢ (Added)
- æ–°å¢ `_ChatComposer` ç»„ä»¶ï¼Œç»Ÿä¸€æ‰¿è½½ï¼š
  - è¾“å…¥æ¡†å®¹å™¨æ ·å¼ï¼ˆåœ†è§’å¡ç‰‡ã€è¾¹æ¡†é«˜äº®ã€é˜´å½±ï¼‰
  - å‘é€æŒ‰é’®çŠ¶æ€åŠ¨ç”»ï¼ˆå‘é€å›¾æ ‡/åŠ è½½æ€åˆ‡æ¢ï¼‰
  - æ¡Œé¢ç«¯ä¸ç§»åŠ¨ç«¯çš„å¿«æ·æç¤ºæ–‡æ¡ˆ

### ğŸ› ï¸ å˜æ›´ (Changed)
- èŠå¤©é¡µåº•éƒ¨è¾“å…¥åŒºä»â€œä¸‹åˆ’çº¿ TextField + æŒ‰é’®â€æ”¹ä¸ºâ€œä¸»é¢˜åŒ–å®¹å™¨è¾“å…¥ç»„ä»¶â€ã€‚
- é”®ç›˜äº‹ä»¶ç›‘å¬ç”± `KeyboardListener` è°ƒæ•´ä¸º `Focus(onKeyEvent)`ï¼Œä¸ `TextField` èšç„¦é“¾è·¯å¯¹é½ï¼Œé™ä½ç„¦ç‚¹å†²çªé£é™©ã€‚
- å‘é€é“¾è·¯æ–°å¢å¹¶å‘ä¿æŠ¤ï¼šåœ¨ `_sending` æˆ– `isProcessing` æ—¶ç›´æ¥æ‹¦æˆªé‡å¤å‘é€ã€‚
- `Ctrl+Enter` æ’å…¥æ¢è¡Œæ—¶å¢åŠ æ— æ•ˆ selection å…œåº•ï¼Œé¿å…å…‰æ ‡å¼‚å¸¸å¯¼è‡´çš„èŒƒå›´é”™è¯¯ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ LaTeX å—çº§è¯­æ³•æ­£åˆ™ä¸­ä½¿ç”¨å†…è” `(?s)` æ ‡å¿—å¯¼è‡´çš„è¿è¡ŒæœŸå…¼å®¹é£é™©ï¼Œé¿å…æ¶ˆæ¯æ¸²æŸ“é˜¶æ®µè§¦å‘é¡µé¢å´©æºƒã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å¯¹è¯è¾“å…¥åŒºåŸŸä»é¡µé¢å†…è”å®ç°æ”¶æ•›ä¸ºç‹¬ç«‹ç»„ä»¶ `_ChatComposer`ï¼Œåç»­å¯ä»¥åœ¨å…¶ä»–é¡µé¢å¤ç”¨åŒä¸€è¾“å…¥ä½“éªŒå¹¶é›†ä¸­ç»´æŠ¤è¾“å…¥è¡Œä¸ºã€‚

---

## 2026-02-10 (UI): èŠå¤©æ°”æ³¡æ–°å¢ LaTeX å…¬å¼æ¸²æŸ“æ”¯æŒ

### ğŸ¯ ç›®æ ‡
è®© AI å¯¹è¯ä¸­çš„æ•°å­¦è¡¨è¾¾å¼åœ¨èŠå¤©æ°”æ³¡å†…ç›´æ¥å¯è¯»æ¸²æŸ“ï¼Œé¿å…å…¬å¼ä»¥çº¯ Markdown æ–‡æœ¬æ˜¾ç¤ºå½±å“é˜…è¯»ã€‚

### âœ¨ æ–°å¢ (Added)
- èŠå¤©æ°”æ³¡æ”¯æŒ LaTeX å…¬å¼è¯­æ³•ï¼š
  - è¡Œå†…å…¬å¼ï¼š`$...$`
  - å—çº§å…¬å¼ï¼š`$$...$$`
- æ–°å¢å…¬å¼æ¸²æŸ“ä¾èµ–ï¼š
  - `flutter_math_fork`
  - `markdown`

### ğŸ› ï¸ å˜æ›´ (Changed)
- `chat_page.dart` ä¸­ `MarkdownBody` å¢åŠ è‡ªå®šä¹‰ LaTeX è¯­æ³•è§£æä¸æ¸²æŸ“å™¨ï¼š
  - `_InlineLatexSyntax`
  - `_BlockLatexSyntax`
  - `_LatexElementBuilder`
- å…¬å¼è§£æå¤±è´¥æ—¶å›é€€ä¸ºåŸå§‹å…¬å¼æ–‡æœ¬æ˜¾ç¤ºï¼ˆçº¢è‰²ï¼‰ï¼Œé¿å…æ¶ˆæ¯æ¸²æŸ“ä¸­æ–­ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å¯¹è¯æ¸²æŸ“é“¾è·¯ä»â€œçº¯ Markdown æ–‡æœ¬â€å‡çº§ä¸ºâ€œMarkdown + LaTeX å¤åˆæ¸²æŸ“â€ï¼Œä»…å½±å“å‰ç«¯å±•ç¤ºå±‚ï¼Œä¸æ”¹å˜åç«¯ RAG/å¼•ç”¨æ•°æ®ç»“æ„ã€‚

---

## 2026-02-10 (Hotfix v10): æ”¹ç”¨ DashScope ç›´è¿ HTTP ç”Ÿæˆï¼Œç»•å¼€ SDK ç©ºå“åº”é“¾è·¯

### ğŸ¯ ç›®æ ‡
å½»åº•ä¿®å¤ `AgentChatResponse = Empty Response` ä¸”åç»­ `llm.chat` ç½‘ç»œé‡è¯•ä¸ç¨³å®šå¯¼è‡´çš„â€œæœ‰æ£€ç´¢ã€æ— ç¨³å®šå›ç­”/æ— å¼•ç”¨â€é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `chat/query` ä» `as_chat_engine().chat()` çš„ç”Ÿæˆé“¾è·¯æ”¹ä¸ºï¼š
  - **æ£€ç´¢**ï¼šæœ¬åœ° `as_retriever()` å®Œæˆï¼ˆä»ä¿ç•™ source filtersï¼‰ã€‚
  - **ç”Ÿæˆ**ï¼šåç«¯ç›´æ¥è°ƒç”¨ DashScope HTTP æ¥å£ï¼ˆ`/text-generation/generation`ï¼‰ï¼Œä¸å†ä¾èµ– LlamaIndex DashScope SDK çš„ç”Ÿæˆè·¯å¾„ã€‚
- RAG è·¯å¾„æ”¹ä¸ºâ€œå…ˆå‘ citationsï¼Œå†å‘ tokenâ€ï¼Œä¿è¯å¼•ç”¨ä¼˜å…ˆè½åˆ°å‰ç«¯ã€‚
- å½“è¿œç¨‹ç”Ÿæˆå¤±è´¥æ—¶ï¼ŒåŸºäºå·²æ£€ç´¢ç‰‡æ®µè¿”å›æœ¬åœ°é™çº§ç­”å¤ï¼Œé¿å…ç©ºç™½ã€‚
- `test_chat_streaming` åŒæ­¥æ›´æ–°åˆ°æ–°é“¾è·¯ï¼ˆmock retriever + mock `_call_dashscope_chat`ï¼‰ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº† `chat_engine` è¿”å› `Empty Response` å¯¼è‡´çš„ä¸»å›ç­”ä¸ç¨³å®šã€‚
- ä¿®å¤äº†å¼•ç”¨æ•°æ®å­˜åœ¨ä½†ç”Ÿæˆå¤±è´¥æ—¶å¼•ç”¨æ— æ³•å¯é åˆ°è¾¾ UI çš„é—®é¢˜ã€‚

---

## 2026-02-10 (Hotfix v9): RAG å¼•ç”¨ä¼˜å…ˆæŠ•é€’ + æœ¬åœ°é™çº§ç­”å¤

### ğŸ¯ ç›®æ ‡
ä¿®å¤â€œRAG æ£€ç´¢æœ‰ç»“æœä½†å¼•ç”¨ä¸æ˜¾ç¤ºã€æ­£æ–‡ä¸ºç©ºâ€åœºæ™¯ä¸‹çš„å¯ç”¨æ€§é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `chat/query` åœ¨ RAG è·¯å¾„ä¸‹æ”¹ä¸º**å…ˆå‘é€ citations äº‹ä»¶**ï¼Œå†å‘é€ tokenï¼Œç¡®ä¿å¼•ç”¨ä¸ä¼šå› åç»­ç”Ÿæˆå¤±è´¥è€Œä¸¢å¤±ã€‚
- å½“ RAG/LLM è¿”å›ç©ºæ­£æ–‡æ—¶ï¼Œä¸å†åªå› errorï¼Œè€Œæ˜¯åŸºäºå·²æ£€ç´¢ç‰‡æ®µç”Ÿæˆæœ¬åœ°é™çº§ç­”å¤ï¼Œä¿è¯ UI å§‹ç»ˆæœ‰å¯è¯»è¾“å‡ºã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº†â€œsource_nodes å·²å‘½ä¸­ä½†å‰ç«¯æ— å¼•ç”¨ chipsâ€çš„é“¾è·¯ç¨³å®šæ€§é—®é¢˜ã€‚

---

## 2026-02-10 (Hotfix v8): å¼•ç”¨äº‹ä»¶ä¼˜å…ˆå‘é€ï¼Œä¿®å¤â€œæœ‰å›ç­”æ— å¼•ç”¨â€å¯è§æ€§é—®é¢˜

### ğŸ¯ ç›®æ ‡
åœ¨ RAG å›ç­”é“¾è·¯ä¸­ç¡®ä¿å¼•ç”¨æ¡ç›®ä¼˜å…ˆåˆ°è¾¾å‰ç«¯ï¼Œå³ä½¿åç»­ token æµä¸­æ–­ä¹Ÿä¸ä¸¢å¼•ç”¨å±•ç¤ºã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `chat/query` åœ¨ RAG æˆåŠŸè·¯å¾„ä¸‹æ”¹ä¸ºå…ˆå‘é€ `citations` äº‹ä»¶ï¼Œå†å‘é€ `token` äº‹ä»¶ã€‚
- åç«¯ citation çš„ `score` å­—æ®µå¼ºåˆ¶æ•°å€¼åŒ–ï¼Œé¿å… `null` è§¦å‘å®¢æˆ·ç«¯è§£æå¼‚å¸¸ã€‚
- å‰ç«¯ `AppState` æ–°å¢ `_parseCitations()` å®¹é”™è§£æï¼Œå•æ¡åæ•°æ®ä¸å½±å“æ•´æ¡å›ç­”ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤â€œåç«¯æ—¥å¿—æ˜¾ç¤ºå·²å‘é€ citationsï¼Œä½† UI æ— å¼•ç”¨ chipsâ€çš„é“¾è·¯ä¸ç¨³å®šé—®é¢˜ã€‚

---

## 2026-02-10 (Hotfix v7): ä¿®å¤ RAG æ¨¡å¼ä¸‹ AI å›å¤ä¸ºç©º (Empty Response) çš„é€»è¾‘ç¼ºé™·

### ğŸ¯ ç›®æ ‡
è§£å†³åœ¨ SSE æµå¼ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒRAG æ¨¡å¼å› å¯¹è±¡æå–å¤±è´¥æˆ– LLM æ‹’ç­”å¯¼è‡´çš„å›å¤å†…å®¹ä¸ºç©ºï¼ˆEmpty Responseï¼‰é—®é¢˜ã€‚

### ğŸ› ï¸ ä¿®å¤ (Fixed)
- **RAG å“åº”æå–å¢å¼º**ï¼šä¼˜åŒ– `_extract_response_text` é€»è¾‘ï¼Œæ”¯æŒ LlamaIndex ChatEngine è¿”å›çš„å¤šç§å“åº”å¯¹è±¡ç»“æ„ã€‚
- **å¼ºåˆ¶ Prompt å›é€€æœºåˆ¶**ï¼šå½“ ChatEngine æ£€ç´¢åè¿”å›ç©ºå“åº”æ—¶ï¼Œè‡ªåŠ¨æ„é€ åŒ…å«èƒŒæ™¯èµ„æ–™çš„æ˜¾å¼ Prompt å¹¶å›é€€è‡³åº•å±‚çš„ `llm.chat` æ¥å£ï¼Œç¡®ä¿å›å¤ç”Ÿæˆçš„æˆåŠŸç‡ã€‚
- **SSE ç¨³å®šæ€§ä¼˜åŒ–**ï¼šä¿®å¤äº†åœ¨ RAG è·¯å¾„ä¸­å¯èƒ½å¯¼è‡´ç”Ÿæˆå™¨æå‰å…³é—­çš„é€»è¾‘ï¼Œå¹¶åœ¨æå–å¤±è´¥æ—¶æä¾›æ›´æ¸…æ™°çš„ Fallback è·¯å¾„ã€‚
- **è°ƒè¯•æ—¥å¿—å¢å¼º**ï¼šåœ¨æ§åˆ¶å°è¯¦ç»†æ‰“å° RAG æ£€ç´¢åˆ°çš„èŠ‚ç‚¹æ•°é‡ã€æå–ç»“æœåŠ Fallback çŠ¶æ€ï¼Œä¾¿äºåç»­æ’æŸ¥ã€‚

### 2026-02-10 (Hotfix v6): å¼ºåˆ¶ DashScope ç›´è¿ä¼˜å…ˆï¼Œé¿å…ä»£ç†é“¾è·¯å¡æ­»

### ğŸ¯ ç›®æ ‡
åœ¨ `DASHSCOPE_FORCE_NO_PROXY=true` åœºæ™¯ä¸‹ï¼Œå½»åº•é¿å… DashScope è¯·æ±‚å…ˆèµ°ä»£ç†å†å›é€€å¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ä¸æ— å“åº”ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `chat/query` çš„ DashScope è°ƒç”¨ç­–ç•¥æ”¹ä¸ºï¼š
  - å½“ `DASHSCOPE_FORCE_NO_PROXY=true` æ—¶ï¼Œå…ˆæ˜¾å¼æ¸…ç©ºä»£ç†å˜é‡å¹¶é™„åŠ  DashScope åˆ° `NO_PROXY`ï¼Œç›´æ¥èµ°ç›´è¿æ¨¡å¼ã€‚
  - è¶…æ—¶ä»é•¿ç­‰å¾…æ”¶æ•›ä¸ºçŸ­ç­‰å¾…ï¼ˆ18sï¼‰ï¼Œå¹¶ä¿ç•™ä¸€æ¬¡åŒæ¨¡å¼å¿«é€Ÿé‡è¯•ã€‚
- åˆ†ç±»å™¨ä¸ Embedding HTTP å®¢æˆ·ç«¯å¯¹é½ï¼š
  - `classifier` åœ¨å¼ºåˆ¶ç›´è¿æ¨¡å¼ä¸‹åŒæ ·å…ˆç¦ä»£ç†å†è¯·æ±‚ã€‚
  - `dashscope_http_embedding` ä¸ `smart_embedding` åœ¨å¼ºåˆ¶ç›´è¿æ¨¡å¼ä¸‹æ˜¾å¼ä¼ å…¥ `proxies={\"http\": None, \"https\": None}`ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº†å¼ºåˆ¶ç›´è¿å·²å¼€å¯ä½†è¯·æ±‚ä»å¯èƒ½å…ˆç»è¿‡ä»£ç†é“¾è·¯ï¼Œå¯¼è‡´ RAG æŸ¥è¯¢é˜¶æ®µå¡åœ¨é‡è¯•å¹¶é•¿æœŸæ—  token è¾“å‡ºçš„é—®é¢˜ã€‚

---

## 2026-02-10 (Hotfix v5): qwen3 éæµå¼å‚æ•°ä¿®æ­£ + DashScope ç›´è¿ç”Ÿæ•ˆ

### ğŸ¯ ç›®æ ‡
åœ¨ç”¨æˆ·å½“å‰ç½‘ç»œç¯å¢ƒï¼ˆGsou TUN + è§„åˆ™ä»£ç†ï¼‰ä¸‹ï¼Œç¡®ä¿ `qwen3-32b` èƒ½ç¨³å®šè¿”å›æ­£æ–‡ï¼Œä¸å†å‡ºç°â€œæœ‰æ£€ç´¢æ— å›ç­”â€ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **qwen3 è°ƒç”¨å‚æ•°å…¼å®¹**:
  - å¯¹ `qwen3*` æ¨¡å‹çš„éæµå¼è°ƒç”¨ç»Ÿä¸€æ³¨å…¥ `enable_thinking=false`ï¼ˆèŠå¤©ä¸åˆ†ç±»é“¾è·¯ï¼‰ï¼Œä¿®å¤ DashScope 400 å‚æ•°é”™è¯¯ã€‚
- **DashScope ç›´è¿ç­–ç•¥**:
  - è¿è¡Œé…ç½®è°ƒæ•´ä¸º `DASHSCOPE_FORCE_NO_PROXY=1`ï¼Œä¿æŒç³»ç»Ÿä»£ç†è®¾ç½®åŒæ—¶å¯¹ DashScope åŸŸåå¼ºåˆ¶èµ° `NO_PROXY`ï¼ˆç» TUN ç›´è¿ï¼‰ã€‚
- **é”™è¯¯å¯è§‚æµ‹æ€§å¢å¼º**:
  - å½“ DashScope è¿”å›é 200 æ—¶ï¼Œæå– `raw.code/raw.message` å›ä¼ åˆ°ä¸Šå±‚é”™è¯¯ä¿¡æ¯ï¼Œé¿å…â€œç©ºå“åº”â€æ©ç›–çœŸå®åŸå› ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ `qwen3-32b` åœ¨éæµå¼è·¯å¾„ä¸‹è¿”å› `InvalidParameter: parameter.enable_thinking must be set to false for non-streaming calls` å¯¼è‡´çš„ç©ºå“åº”é—®é¢˜ã€‚

### âœ… éªŒè¯ (Verification)
- æœ¬åœ°ç›´æ¥è°ƒç”¨ `Settings.llm.chat`ï¼ˆ`qwen3-32b`ï¼‰å·²è¿”å› `OK`ï¼Œ`raw.status_code=200`ã€‚

---

## 2026-02-10 (Hotfix v4): DashScope SSL EOF é‡è¯•ç­–ç•¥åŠ å›º

### ğŸ¯ ç›®æ ‡
ä¿®å¤èŠå¤©é˜¶æ®µåœ¨ SOCKS ä»£ç†é“¾è·¯ä¸‹è§¦å‘ `SSLEOFError` æ—¶æœªå‘½ä¸­å›é€€æ¡ä»¶çš„é—®é¢˜ï¼Œé¿å…å†æ¬¡å‡ºç° RAG æœ‰å¼•ç”¨ä½†å›ç­”ä¸­æ–­ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **`chat/query` ç½‘ç»œå›é€€å¢å¼º**:
  - æ‰©å±•ç½‘ç»œé”™è¯¯è¯†åˆ«è§„åˆ™ï¼šæ”¯æŒ `SOCKSHTTPSConnectionPool`ã€`SSLEOFError`ã€`Max retries exceeded`ã€`Cannot connect` ç­‰æ–‡æœ¬æ¨¡å¼ã€‚
  - å›é€€ç­–ç•¥å‡çº§ä¸ºä¸‰æ®µå¼ï¼š
    - ä¿æŒå½“å‰ä»£ç†é…ç½®å…ˆå°è¯•ï¼›
    - å¤±è´¥åè‡ªåŠ¨é™„åŠ  DashScope åˆ° `NO_PROXY` å†è¯•ï¼›
    - å†å¤±è´¥æ—¶ä¸´æ—¶æ¸…ç©º `HTTP(S)_PROXY/ALL_PROXY` åé‡è¯•ä¸€æ¬¡ã€‚
- **åˆ†ç±»å™¨é“¾è·¯å¯¹é½**:
  - `classifier` ä» `achat` å•è·¯å¾„æ”¹ä¸ºä¸èŠå¤©ä¸€è‡´çš„åŒæ­¥çº¿ç¨‹è°ƒç”¨ + ä»£ç†å›é€€å…œåº•ï¼Œé™ä½ä¸Šä¼ é˜¶æ®µåˆ†ç±»å‘Šè­¦å™ªå£°ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº† `chat.py` ä¸­â€œä»…åŒ¹é… `dashscope.aliyuncs.com:443`â€å¯¼è‡´å¤§é‡çœŸå®ç½‘ç»œå¼‚å¸¸æœªè§¦å‘å›é€€çš„ç¼ºé™·ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- DashScope è°ƒç”¨é“¾ä»â€œå•ä¸€æ–‡æœ¬åŒ¹é…å›é€€â€å‡çº§ä¸ºâ€œå¼‚å¸¸æ¨¡å¼è¯†åˆ« + ä»£ç†ç­–ç•¥åˆ†å±‚é€€åŒ–â€ï¼Œåœ¨ä»£ç†æ³¢åŠ¨åœºæ™¯ä¸‹å¯ç”¨æ€§æ˜¾è‘—æå‡ã€‚

---

## 2026-02-10 (Hotfix v3): å¯¹è¯ç©ºå“åº”é—­ç¯ä¿®å¤ + è¿›åº¦æ¡è§†è§‰å›å½’

### ğŸ¯ ç›®æ ‡
ä¿®å¤â€œRAG æœ‰å¼•ç”¨ä½†å›ç­”ä¸ºç©ºï¼ˆEmpty Responseï¼‰â€ä»¥åŠæ¥æºé¡µè¿›åº¦æ¡è§†è§‰å™ªå£°è¿‡é«˜çš„é—®é¢˜ï¼Œæ¢å¤ç¨³å®šã€å¯è¯»çš„å¯¹è¯ä¸ä¸Šä¼ ä½“éªŒã€‚

### âœ¨ æ–°å¢ (Added)
- **åç«¯ SSE ç©ºå“åº”å…œåº•**:
  - `chat/query` æ–°å¢ `_extract_response_text()`ï¼Œç»Ÿä¸€æå–ä¸åŒ LLM è¿”å›ç»“æ„ä¸­çš„æ­£æ–‡å†…å®¹ã€‚
  - å½“é¦–æ¬¡å“åº”ä¸ºç©ºæ—¶å¢åŠ äºŒæ¬¡é‡è¯•ï¼›é‡è¯•åä»ä¸ºç©ºæ—¶ï¼Œæ˜¾å¼è¿”å› `error` äº‹ä»¶ï¼Œä¸å†é™é»˜è¾“å‡ºç©ºç™½ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **RAG å›ç­”ç”Ÿæˆç­–ç•¥**:
  - åœ¨â€œæ£€ç´¢åˆ°å¼•ç”¨ä½†æ­£æ–‡ä¸ºç©ºâ€åœºæ™¯ï¼Œæ–°å¢åŸºäºå¼•ç”¨å†…å®¹é‡æ„ prompt çš„å›é€€ç”Ÿæˆè·¯å¾„ï¼Œä¼˜å…ˆäº‰å–å¯è¯»æ­£æ–‡ã€‚
- **å‰ç«¯ SSE è§£æå™¨**:
  - `ApiClient.queryStream()` å…¼å®¹ `\n\n` ä¸ `\r\n\r\n` äº‹ä»¶åˆ†éš”ï¼Œå‡å°‘ Windows/ä»£ç†é“¾è·¯ä¸‹çš„äº‹ä»¶åˆ‡åˆ†è¯¯åˆ¤ã€‚
- **è¿›åº¦æ¡ UI**:
  - æ¥æºå¡ç‰‡ä»â€œä¸‰å±‚å åŠ åŠ¨ç”» + æ‰«å…‰ç‰¹æ•ˆâ€å›é€€ä¸ºâ€œå•æ¡è¿›åº¦ + ç™¾åˆ†æ¯” + é˜¶æ®µæ–‡æ¡ˆâ€ï¼Œæå‡ä¿¡æ¯å¯è¯»æ€§ä¸è§†è§‰ç¨³å®šæ€§ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤èŠå¤©æµä¸­â€œä»…æ”¶åˆ° citationsã€æœªæ”¶åˆ° tokenâ€æ—¶å‰ç«¯é•¿æœŸåœç•™ `...` çš„é—®é¢˜ã€‚
- ä¿®å¤ `test_chat_streaming` ä¸å½“å‰ `as_chat_engine.chat` å®ç°è„±èŠ‚ï¼Œå¯¼è‡´çš„æµ‹è¯•å¤±çœŸé—®é¢˜ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- èŠå¤©é“¾è·¯ä»â€œå¯èƒ½é™é»˜ç©ºæ–‡æœ¬â€å‡çº§ä¸ºâ€œæ­£æ–‡æå– -> äºŒæ¬¡é‡è¯• -> æ˜¾å¼é”™è¯¯äº‹ä»¶â€çš„ç¡®å®šæ€§æ”¶æ•›æµç¨‹ã€‚
- å‰ç«¯å±•ç¤ºé“¾è·¯ä»â€œå ä½æ–‡æœ¬å¯èƒ½æ®‹ç•™â€å‡çº§ä¸ºâ€œæµç»“æŸåæ ¹æ® token/error åšç»ˆæ€æ”¶æ•›â€ï¼Œé¿å…è„ UI çŠ¶æ€ã€‚

---

## 2026-02-10 (Hotfix v2): è¿æ¥å…œåº•å¢å¼ºä¸è½®è¯¢é£æš´è¿›ä¸€æ­¥æŠ‘åˆ¶

### ğŸ¯ ç›®æ ‡
ç»§ç»­å¤„ç†â€œçŠ¶æ€è¯·æ±‚è¿‡å¯†â€â€œè¿›åº¦è·³è·ƒæ˜æ˜¾â€â€œèŠå¤©å¶å‘è¿æ¥é”™è¯¯â€ä¸‰ç±»æ®‹ç•™é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **å‰ç«¯è½®è¯¢**:
  - `AppState._startPolling()` å¯åŠ¨å‰å…ˆ `cancel` æ—§å®šæ—¶å™¨ï¼Œé¿å…é‡å¤åˆ›å»ºè½®è¯¢å™¨ã€‚
  - è½®è¯¢é—´éš”ç»´æŒ 5 ç§’ï¼Œé…åˆäº’æ–¥é”å‡å°‘çŠ¶æ€è¯·æ±‚é£æš´ã€‚
- **Embedding ç¨³å®šæ€§**:
  - `smart_embedding` HTTP è°ƒç”¨æ–°å¢å¤±è´¥åâ€œä¸´æ—¶ NO_PROXY å†è¯•ä¸€æ¬¡â€å…œåº•ã€‚
  - å•æ‰¹é‡è¯•ç­–ç•¥ä»é•¿é€€é¿æ”¹ä¸ºçŸ­é€€é¿ï¼ˆæœ€å¤š 3 æ¬¡ï¼Œæ¯æ¬¡ 1 ç§’ï¼‰ï¼Œé¿å…é•¿æ—¶é—´å¡åœ¨å•ä¸ª chunkã€‚
- **èŠå¤©ç¨³å®šæ€§**:
  - `chat/query` å¤±è´¥åå¢åŠ â€œé€šç”¨å›ç­”æœ€ç»ˆé™çº§â€å…œåº•ï¼Œé¿å…å°†åº•å±‚ç½‘ç»œå¼‚å¸¸ç›´æ¥æŠ›åˆ° Flutter UIã€‚
  - ä¿æŒ SSE ç»“æ„ï¼Œä»æŒ‰ token ç‰‡æ®µè¿”å›ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ç½‘ç»œé“¾è·¯ä»â€œå•è·¯å¾„å¤±è´¥å³ä¸­æ–­â€å‡çº§ä¸ºâ€œä»£ç†è·¯å¾„ + ç›´è¿ä¸´æ—¶å›é€€ + æœ€ç»ˆä¸šåŠ¡é™çº§â€çš„ä¸‰å±‚å®¹é”™ã€‚
- çŠ¶æ€è½®è¯¢é“¾è·¯è¿›ä¸€æ­¥æ”¶æ•›ï¼Œé™ä½å®¢æˆ·ç«¯é‡å¤å®šæ—¶å™¨å¸¦æ¥çš„åç«¯å™ªå£°ã€‚

---

## 2026-02-10 (Hotfix): è½®è¯¢é£æš´æŠ‘åˆ¶ä¸èŠå¤©è¿æ¥å…œåº•é‡è¯•

### ğŸ¯ ç›®æ ‡
ç¼“è§£ä¸Šä¼ çŠ¶æ€æ¥å£é«˜é¢‘è¯·æ±‚å¯¼è‡´çš„â€œè¯·æ±‚çœ‹èµ·æ¥æ— æ•°æ¬¡â€é—®é¢˜ï¼Œå¹¶é™ä½èŠå¤©é˜¶æ®µå¶å‘ `Cannot connect to host dashscope.aliyuncs.com:443` çš„å¤±è´¥ç‡ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- å‰ç«¯çŠ¶æ€è½®è¯¢é—´éš”ä» 2 ç§’è°ƒæ•´ä¸º 5 ç§’ï¼Œé…åˆå·²æœ‰é˜²é‡å…¥é”ï¼Œå‡å°‘é‡å¤è¯·æ±‚å¯†åº¦ã€‚
- è¿›åº¦æ¡å¢åŠ  `TweenAnimationBuilder` å¹³æ»‘è¡¥é—´ï¼Œé™ä½ `1/7 -> 6/7` çš„è§†è§‰è·³å˜ã€‚
- èŠå¤©æ¥å£æ–°å¢ç½‘ç»œå›é€€é€»è¾‘ï¼š
  - é¦–æ¬¡å¤±è´¥åè‡ªåŠ¨ä¸´æ—¶åˆ‡æ¢ DashScope åˆ° `NO_PROXY` å†é‡è¯•ä¸€æ¬¡ã€‚
  - SSE é”™è¯¯æ–‡æ¡ˆæ”¹ä¸ºç”¨æˆ·å¯è¯»æç¤ºï¼Œé¿å…æŠŠåº•å±‚è¿æ¥æ ˆä¿¡æ¯ç›´æ¥å›æ˜¾åˆ° UIã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- çŠ¶æ€æ‹‰å–ä»â€œé«˜é¢‘çŸ­è½®è¯¢â€æ”¶æ•›ä¸ºâ€œä¸­é¢‘è½®è¯¢ + UI å¹³æ»‘æ’å€¼â€ï¼Œé™ä½æ¥å£å™ªå£°åŒæ—¶ä¿æŒå¯æ„ŸçŸ¥è¿›åº¦ã€‚
- èŠå¤©é“¾è·¯å¢åŠ â€œä»£ç†å¤±è´¥ -> ç›´è¿å›é€€â€å•æ¬¡è‡ªåŠ¨å…œåº•ï¼Œæé«˜å¤æ‚ç½‘ç»œç¯å¢ƒå¯ç”¨æ€§ã€‚

---

## 2026-02-10 (Stability Patch): è½®è¯¢é˜²é‡å…¥ + èŠå¤©é“¾è·¯æ”¹åŒæ­¥è°ƒç”¨

### ğŸ¯ ç›®æ ‡
è§£å†³ä¸Šä¼ çŠ¶æ€æ¥å£é«˜é¢‘é‡å¤è¯·æ±‚ï¼Œä»¥åŠèŠå¤©é˜¶æ®µä»å‡ºç° `Cannot connect to host dashscope.aliyuncs.com:443 ssl:default [None]` çš„é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **å‰ç«¯è½®è¯¢é˜²é‡å…¥**:
  - `AppState` è½®è¯¢æ–°å¢ `_isPolling` äº’æ–¥é”ï¼Œé˜²æ­¢ `Timer.periodic` åœ¨ä¸Šä¸€æ¬¡è¯·æ±‚æœªç»“æŸæ—¶é‡å…¥ï¼Œå‡å°‘é‡å¤çŠ¶æ€è¯·æ±‚é£æš´ã€‚
  - `AppState.dispose()` ä¸­æ˜¾å¼å–æ¶ˆ `_statusPollingTimer`ï¼Œé¿å…ç”Ÿå‘½å‘¨æœŸæ³„æ¼ã€‚
- **èŠå¤© API ç¨³å®šåŒ–**:
  - `chat/query` æ”¹ä¸ºä¼˜å…ˆä½¿ç”¨åŒæ­¥è°ƒç”¨ï¼ˆ`llm.chat` / `chat_engine.chat`ï¼‰å¹¶é€šè¿‡ `asyncio.to_thread` æ‰§è¡Œï¼Œè§„é¿å¼‚æ­¥åº•å±‚è¿æ¥åœ¨ä»£ç†ç¯å¢ƒä¸­çš„ä¸ç¨³å®šé—®é¢˜ã€‚
  - ä¿ç•™ SSE è¾“å‡ºï¼Œæ”¹ä¸ºå°†å®Œæ•´å“åº”æŒ‰å°ç‰‡æ®µåˆ‡åˆ†åé€æ®µæ¨é€ï¼Œå‰ç«¯ä½“éªŒä¿æŒæµå¼ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- çŠ¶æ€æ‹‰å–ä»â€œå¯èƒ½å¹¶å‘é‡å…¥â€æ”¶æ•›ä¸ºâ€œå•èˆªé“è½®è¯¢â€ï¼Œæ˜¾è‘—é™ä½æœåŠ¡ç«¯é‡å¤è¯·æ±‚å‹åŠ›ã€‚
- èŠå¤©é“¾è·¯ä»â€œå¼‚æ­¥ SDK ç›´è¿â€è°ƒæ•´ä¸ºâ€œåŒæ­¥è°ƒç”¨çº¿ç¨‹åŒ– + SSE å°è£…â€ï¼Œæå‡ä»£ç†/TUN ç¯å¢ƒç¨³å®šæ€§ã€‚

---

## 2026-02-10 (Chat + Progress): ä¿®å¤èŠå¤©æ£€ç´¢ EOF å¹¶ç»†åŒ– Chunk è¿›åº¦åŠ¨ç”»

### ğŸ¯ ç›®æ ‡
è§£å†³èŠå¤©é˜¶æ®µä»è§¦å‘ `SOCKSHTTPSConnectionPool ... SSLEOFError`ï¼Œå¹¶ä¿®å¤ Embedding è¿›åº¦â€œå¡åœ¨ 5/11â€ä¸å¯è§†åé¦ˆä¸è¶³é—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **èŠå¤©æ£€ç´¢é“¾è·¯ Embedding æ›¿æ¢**:
  - æ–°å¢ `DashScopeHTTPEmbedding`ï¼ˆ`server/app/services/dashscope_http_embedding.py`ï¼‰ï¼Œé€šè¿‡ HTTP æ‰¹é‡æ¥å£å®ç°æŸ¥è¯¢å‘é‡ï¼Œä¸å†èµ° SDK å†…éƒ¨å¹¶å‘å•æ¡è·¯å¾„ã€‚
  - `settings.init_llama_index()` æ”¹ä¸ºæ³¨å…¥ `DashScopeHTTPEmbedding` ä½œä¸ºå…¨å±€ `embed_model`ï¼Œè¦†ç›–èŠå¤©/RAG æŸ¥è¯¢é˜¶æ®µã€‚
- **Chunk è¿›åº¦ç»†ç²’åº¦**:
  - `EMBED_BATCH_SIZE` é»˜è®¤å€¼ä» `5` è°ƒæ•´ä¸º `1`ï¼Œä½¿ Embedding é˜¶æ®µå¯æŒ‰ chunk é€æ­¥æ¨è¿›ï¼Œé¿å…é•¿æ—¶é—´åœåœ¨ `5/11`ã€‚
- **è¿›åº¦æ¡åŠ¨ç”»å¢å¼º**:
  - æ¥æºå¡ç‰‡è¿›åº¦æ¡å¢åŠ æµåŠ¨é«˜å…‰åŠ¨ç”»ï¼ˆ`AnimationController + æ¸å˜é®ç½©`ï¼‰ï¼Œåœ¨çœŸå®æ•°å€¼æ¨è¿›åŸºç¡€ä¸Šæå‡â€œæ­£åœ¨è¿›è¡Œä¸­â€çš„å¯æ„ŸçŸ¥æ€§ã€‚

### âœ¨ æ–°å¢ (Added)
- æ–°å¢æµ‹è¯• `server/tests/test_dashscope_http_embedding.py`ï¼Œè¦†ç›– HTTP embedding è¿”å›æ’åºé€»è¾‘ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- æŸ¥è¯¢é˜¶æ®µ embedding ä¸å…¥åº“é˜¶æ®µ embedding ç»Ÿä¸€ä¸ºâ€œåç«¯å¯æ§ HTTP å®ç°â€ï¼Œé™ä½ç¬¬ä¸‰æ–¹ SDK å¹¶å‘ç­–ç•¥å¯¼è‡´çš„ç½‘ç»œæŠ–åŠ¨é£é™©ã€‚

---

## 2026-02-10 (UX + Pipeline): ä»»åŠ¡è¿›åº¦æ”¹ä¸ºçœŸå®é˜¶æ®µé©±åŠ¨

### ğŸ¯ ç›®æ ‡
å°†ä¸Šä¼ ä»»åŠ¡ä»â€œå›ºå®šæ–‡æ¡ˆ + ç²—ç²’åº¦è¿›åº¦â€å‡çº§ä¸ºâ€œåç«¯çœŸå®é˜¶æ®µé©±åŠ¨ + å‰ç«¯é€ä»»åŠ¡ç»†ç²’åº¦å±•ç¤ºâ€ï¼Œå°¤å…¶ç»†åŒ– Chunk Embedding é˜¶æ®µã€‚

### âœ¨ æ–°å¢ (Added)
- åç«¯ ingestion è¿›åº¦æ”¹ä¸ºç»“æ„åŒ– JSONï¼š
  - `progress`ï¼š0~1 å®æ—¶è¿›åº¦
  - `stage`ï¼šé˜¶æ®µæ ‡è¯†ï¼ˆå¦‚ `chunking`/`embedding`/`indexing`ï¼‰
  - `message`ï¼šé˜¶æ®µæ–‡æ¡ˆ
  - `detail`ï¼šé™„åŠ ç»†èŠ‚ï¼ˆå¦‚ `embedded_chunks/total_chunks`ï¼‰
- å‰ç«¯ `SourceItem` æ–°å¢ï¼š
  - `stage`
  - `stageMessage`

### ğŸ› ï¸ å˜æ›´ (Changed)
- `GET /api/v1/files/{doc_id}/status` æ”¯æŒè¿”å› `stage/message/detail`ï¼Œå¹¶å…¼å®¹æ—§çš„çº¯æ•°å­—è¿›åº¦ç¼“å­˜å€¼ã€‚
- å‰ç«¯æ¥æºå¡ç‰‡çŠ¶æ€æ–‡æ¡ˆæ”¹ä¸ºè¯»å–æœåŠ¡ç«¯é˜¶æ®µæ–‡æ¡ˆï¼Œä¸å†å›ºå®šâ€œæ­£åœ¨ä¸Šä¼ /AI æ­£åœ¨è§£æâ€ã€‚
- è¿›åº¦æ¡æ”¹ä¸ºçœŸå® `source.progress` é©±åŠ¨ï¼ŒæŒ‰ä»»åŠ¡å•ç‹¬æ›´æ–°ã€‚
- Embedding é˜¶æ®µè¿›åº¦æŒ‰å·²å¤„ç† chunk æ•°å¢é‡æ¨è¿›ï¼Œæ–‡æ¡ˆæ˜¾ç¤º `è®¡ç®—å‘é‡ä¸­ (x/y)`ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ `StorageService` ç¼ºå¤± `read_file` å¯¼è‡´ `/files/{doc_id}/classify` æŠ¥é”™çš„é—®é¢˜ã€‚
- ä¿®å¤ `SourceItem.copyWith` æ›´æ–°çŠ¶æ€æ—¶ä¸¢å¤± `fileHash` çš„é—®é¢˜ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- çŠ¶æ€é“¾è·¯ä» `workerå†…éƒ¨æµ®ç‚¹è¿›åº¦` å‡çº§ä¸º `workeré˜¶æ®µäº‹ä»¶ -> Redisç»“æ„åŒ–è¿›åº¦ -> API -> å‰ç«¯ä»»åŠ¡å¡ç‰‡`ï¼Œå®ç°å¯è§‚æµ‹ä¸”å¯è§£é‡Šçš„å…¨é“¾è·¯è¿›åº¦ç³»ç»Ÿã€‚

---

## 2026-02-10 (Critical Fix): ç»•å¼€ LlamaIndex å¹¶å‘ Embedding è·¯å¾„

### ğŸ¯ ç›®æ ‡
ä¿®å¤åœ¨ä»£ç†/TUNç½‘ç»œä¸‹ï¼Œ`llama-index` å¯¹ DashScope embedding çš„å¹¶å‘å•æ¡è¯·æ±‚å®¹æ˜“è§¦å‘ `SSLEOFError` çš„æ ¸å¿ƒé—®é¢˜ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `SmartEmbeddingManager` æ”¹ä¸º HTTP æ‰¹é‡è°ƒç”¨ DashScope embedding æ¥å£ï¼š
  - æ¯æ‰¹ `texts` å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼ˆå•è¿æ¥å•è¯·æ±‚ï¼‰ï¼Œä¸å†èµ° `aget_text_embedding_batch()` çš„å¹¶å‘å•æ¡è°ƒç”¨è·¯å¾„ã€‚
  - è¿”å›ç»“æœæŒ‰ `text_index` æ’åºåå›å¡«ï¼Œç¡®ä¿å‘é‡é¡ºåºä¸è¾“å…¥ä¸€è‡´ã€‚
- ç»§ç»­ä¿ç•™åˆ†æ‰¹ç­–ç•¥ï¼ˆ`EMBED_BATCH_SIZE`ï¼‰ä¸æ¯æ‰¹é‡è¯•æœºåˆ¶ã€‚

### âœ¨ æ–°å¢ (Added)
- æ–°å¢æµ‹è¯• `server/tests/test_smart_embedding_http_batch.py`ï¼Œè¦†ç›– HTTP è¿”å›è§£æä¸é¡ºåºæ ¡éªŒã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- embedding è°ƒç”¨é“¾ä» `LlamaIndex SDK å¹¶å‘è¯·æ±‚` è°ƒæ•´ä¸º `Server è‡ªæ§æ‰¹é‡ HTTP è¯·æ±‚`ï¼Œæ˜¾è‘—é™ä½ TLS æ¡æ‰‹æ”¾å¤§ä¸ä»£ç†é“¾è·¯æŠ–åŠ¨é£é™©ã€‚

---

## 2026-02-10 (DX): æ–°å¢ Windows ä¸€é”®å¯åŠ¨ Flutter è„šæœ¬

### ğŸ¯ ç›®æ ‡
é™ä½ Windows + Gsou Cloud ä»£ç†ç¯å¢ƒä¸‹ Flutter å¼€å‘å¯åŠ¨é—¨æ§›ï¼Œé¿å…æ¯æ¬¡æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

### âœ¨ æ–°å¢ (Added)
- æ–°å¢è„šæœ¬ `client/run_windows.ps1`ï¼š
  - è‡ªåŠ¨è®¾ç½® `PUB_HOSTED_URL` ä¸ `FLUTTER_STORAGE_BASE_URL` é•œåƒæºã€‚
  - è‡ªåŠ¨è®¾ç½® `HTTP_PROXY/HTTPS_PROXY/ALL_PROXY/NO_PROXY`ã€‚
  - é»˜è®¤æ‰§è¡Œ `flutter pub get` åæ‰§è¡Œ `flutter run -d windows`ã€‚
  - æ”¯æŒå‚æ•°ï¼š
    - `-Device` æŒ‡å®šè¿è¡Œè®¾å¤‡ï¼ˆé»˜è®¤ `windows`ï¼‰
    - `-SkipPubGet` è·³è¿‡ä¾èµ–æ‹‰å–

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å°†â€œç½‘ç»œé…ç½® + ä¾èµ–æ‹‰å– + å¯åŠ¨è¿è¡Œâ€ä»äººå·¥å‘½ä»¤ä¸²æ”¶æ•›ä¸ºå•è„šæœ¬å…¥å£ï¼Œé™ä½ç¯å¢ƒæ¼‚ç§»å’Œæ‰‹å·¥è¯¯æ“ä½œæ¦‚ç‡ã€‚

---

## 2026-02-10 (Server Stability): Embedding åˆ†æ‰¹æäº¤ï¼Œé™ä½ TLS/ä»£ç†é“¾è·¯æŠ–åŠ¨

### ğŸ¯ ç›®æ ‡
è§£å†³ä¸Šä¼ ç´¢å¼•æ—¶ä¸€æ¬¡æ€§æäº¤å¤§é‡æ–‡æœ¬å—ï¼ˆå¦‚ 20 chunksï¼‰å¯¼è‡´ DashScope TLS è¿æ¥ä¸ç¨³å®šã€è§¦å‘ `SSLEOFError` çš„é—®é¢˜ã€‚

### âœ¨ æ–°å¢ (Added)
- é…ç½®é¡¹ `EMBED_BATCH_SIZE`ï¼ˆé»˜è®¤ `5`ï¼‰ï¼Œç”¨äºæ§åˆ¶ embedding æ‰¹é‡è¯·æ±‚å¤§å°ã€‚
- `SmartEmbeddingManager._iter_batches()`ï¼šç»Ÿä¸€åˆ†æ‰¹è¿­ä»£é€»è¾‘ã€‚
- æ–°å¢æµ‹è¯• `server/tests/test_smart_embedding_batching.py` è¦†ç›–åˆ†æ‰¹åˆ‡åˆ†ä¸è¾¹ç•Œè¾“å…¥ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `smart_embedding` ä»â€œå•æ¬¡å¤§æ‰¹é‡è¯·æ±‚â€æ”¹ä¸ºâ€œåˆ†æ‰¹é¡ºåºè¯·æ±‚ + æ¯æ‰¹ç‹¬ç«‹é‡è¯• + è¿›åº¦å›è°ƒå¢é‡æ›´æ–°â€ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å…³é”®é“¾è·¯ä» `20 chunks -> 1 request` è°ƒæ•´ä¸º `20 chunks -> 4 requests(5x4)`ï¼Œæ˜¾è‘—é™ä½å•è¿æ¥ TLS å‹åŠ›ä¸ä»£ç†æŠ–åŠ¨æ”¾å¤§æ•ˆåº”ã€‚

---

## 2026-02-10 (Proxy Protocol Fix): åˆ‡æ¢åˆ° SOCKS5 ä»£ç†å¹¶è¡¥é½ä¾èµ–

### ğŸ¯ ç›®æ ‡
ä¿®å¤ DashScope åœ¨ `26001` ç«¯å£é€šè¿‡ `http://` ä»£ç†æ¡æ‰‹è¶…æ—¶çš„é—®é¢˜ï¼Œæ”¹ä¸ºåŒ¹é… Gsou TUN çš„ SOCKS ä»£ç†åè®®ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `server/.env`:
  - `HTTP_PROXY` æ”¹ä¸º `socks5h://127.0.0.1:26001`
  - `HTTPS_PROXY` æ”¹ä¸º `socks5h://127.0.0.1:26001`
  - ä¿æŒ `DASHSCOPE_FORCE_NO_PROXY=0`
- `server/requirements.txt`:
  - æ–°å¢ `PySocks`ï¼Œè®© `requests/urllib3` å…·å¤‡ SOCKS ä»£ç†æ”¯æŒã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ä»£ç†é“¾è·¯ä» HTTP CONNECT åˆ‡æ¢ä¸º SOCKS5ï¼Œç½‘ç»œåè®®ä¸æœ¬åœ°ä»£ç†ç«¯å£èƒ½åŠ›å¯¹é½ï¼Œé¿å… TLS æ¡æ‰‹é˜¶æ®µè¶…æ—¶/EOFã€‚

---

## 2026-02-10 (Env Config): æ›´æ–°æœ¬åœ°ä»£ç†ç«¯å£ä¸º 26001

### ğŸ¯ ç›®æ ‡
ä½¿æœåŠ¡ç«¯ Python è¿›ç¨‹é€šè¿‡ Gsou Cloud TUN ä»£ç†è®¿é—® DashScopeï¼Œé¿å…ç›´è¿å¯¼è‡´çš„ SSL EOFã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- æ›´æ–° `server/.env`ï¼š
  - `HTTP_PROXY=http://127.0.0.1:26001`
  - `HTTPS_PROXY=http://127.0.0.1:26001`
  - `DASHSCOPE_FORCE_NO_PROXY=0`

---

## 2026-02-10 (Server Proxy Fix): .env ä»£ç†é…ç½®æ³¨å…¥åˆ° Python è¿›ç¨‹

### ğŸ¯ ç›®æ ‡
ä¿®å¤ `.env` ä¸­å·²é…ç½® `HTTP(S)_PROXY` ä½† DashScope SDK å®é™…æœªä½¿ç”¨ï¼Œå¯¼è‡´ Worker ä»ç„¶ç›´è¿å¹¶è§¦å‘ `SSLEOFError` çš„é—®é¢˜ã€‚

### âœ¨ æ–°å¢ (Added)
- `Settings.apply_network_settings()`:
  - å¯åŠ¨æ—¶å°† `HTTP_PROXY/HTTPS_PROXY/NO_PROXY` åŒæ­¥å†™å…¥ `os.environ`ï¼ˆå«å¤§å°å†™å˜é‡ï¼‰ï¼Œç¡®ä¿ requests/SDK èƒ½è¯»å–ã€‚
  - æ”¯æŒ `DASHSCOPE_FORCE_NO_PROXY=true` æ—¶é™„åŠ  DashScope åŸŸååˆ° `NO_PROXY`ã€‚
- æ–°å¢æµ‹è¯• `server/tests/test_network_settings.py`ï¼Œè¦†ç›–ä»£ç†æ³¨å…¥ä¸ NO_PROXY å¼ºåˆ¶ç­–ç•¥ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- `main.py` ä¸ `celery_app.py` åœ¨ `settings.init_llama_index()` ä¹‹å‰ç»Ÿä¸€è°ƒç”¨ `settings.apply_network_settings()`ã€‚
- Celery `worker_process_init` é’©å­ä¸­é‡å¤åº”ç”¨ç½‘ç»œè®¾ç½®ï¼Œé¿å…å­è¿›ç¨‹ç¯å¢ƒæ¼‚ç§»ã€‚
- å¯åŠ¨æ—¶æ–°å¢ç½‘ç»œé…ç½®ç”Ÿæ•ˆæ—¥å¿—ï¼ˆä»…æ˜¾ç¤º set/unsetï¼Œä¸è¾“å‡ºæ•æ„Ÿä»£ç†åœ°å€ï¼‰ï¼Œç”¨äºå¿«é€Ÿç¡®è®¤ä»£ç†æ˜¯å¦æ³¨å…¥æˆåŠŸã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ç½‘ç»œé…ç½®é“¾è·¯ä»â€œ.env ä»…è¢«é…ç½®å¯¹è±¡è¯»å–â€å‡çº§ä¸ºâ€œ.env -> settings -> os.environ -> SDKâ€ï¼Œè¡¥é½äº†ä»£ç†ç”Ÿæ•ˆé—­ç¯ã€‚

---

## 2026-02-10 (Server Network Fix): TUN/ä»£ç†ç¯å¢ƒä¸‹ DashScope è¿æ¥ç¨³å®šæ€§ä¿®å¤

### ğŸ¯ ç›®æ ‡
è§£å†³åœ¨ Gsou Cloud è§„åˆ™æ¨¡å¼ TUN ç¯å¢ƒä¸‹ï¼ŒPython Worker ä¸Šä¼ ç´¢å¼•é˜¶æ®µé¢‘ç¹å‡ºç° `SSLEOFError` çš„é—®é¢˜ï¼Œå¹¶å‡å°‘é”™è¯¯é‡è¯•å¯¼è‡´çš„é•¿æ—¶é—´å¡ä½ã€‚

### âœ¨ æ–°å¢ (Added)
- **å¯é…ç½®ç›´è¿å¼€å…³**:
  - æ–°å¢ `DASHSCOPE_FORCE_NO_PROXY` ç¯å¢ƒå˜é‡ï¼ˆé»˜è®¤å…³é—­ï¼‰ã€‚
  - ä»…åœ¨æ˜¾å¼å¼€å¯æ—¶ï¼Œæ‰ä¸º DashScope è®¾ç½® `NO_PROXY` ç›´è¿ç­–ç•¥ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **ç½‘ç»œåˆå§‹åŒ–ç­–ç•¥æ”¶æ•›**:
  - `main.py` ä¸ `celery_app.py` ä¸å†æ— æ¡ä»¶å¼ºåˆ¶ DashScope ç»•è¿‡ä»£ç†ã€‚
  - åˆ é™¤é»˜è®¤ä¸å®‰å…¨ SSL ä¸Šä¸‹æ–‡æ³¨å…¥é€»è¾‘ï¼Œé¿å…å¯¹ç¬¬ä¸‰æ–¹ HTTP å®¢æˆ·ç«¯äº§ç”Ÿä¸å¯é¢„æœŸå‰¯ä½œç”¨ã€‚
- **ä»»åŠ¡é‡è¯•ç­–ç•¥ä¼˜åŒ–**:
  - æ–°å¢ `worker/retry_policy.py`ï¼Œç»Ÿä¸€å®šä¹‰ä¸å¯é‡è¯•é”™è¯¯åˆ¤å®šã€‚
  - å¯¹ `SSLEOFError`ã€`AuthenticationError`ã€ç¼ºå¤± Embedding Key ç­‰é”™è¯¯ä¸å†è¿›è¡Œ Celery æŒ‡æ•°é€€é¿é‡è¯•ï¼Œç›´æ¥å¤±è´¥å¹¶è¿”å›çŠ¶æ€ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº†ä»£ç†/TUN åœºæ™¯ä¸‹è¢«å¼ºåˆ¶ `NO_PROXY` å¯¼è‡´çš„ DashScope è¿æ¥å¤±è´¥é—®é¢˜ã€‚
- ä¿®å¤äº†ç½‘ç»œç¡¬é”™è¯¯åœºæ™¯ä¸­ä»»åŠ¡é•¿æ—¶é—´é‡å¤é‡è¯•ã€å‰ç«¯çŠ¶æ€è¿Ÿè¿Ÿä¸æ”¶æ•›çš„é—®é¢˜ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- ç½‘ç»œé“¾è·¯ä»â€œç¡¬ç¼–ç ç›´è¿â€è°ƒæ•´ä¸ºâ€œç¯å¢ƒé©±åŠ¨å¯åˆ‡æ¢ï¼ˆä»£ç†/ç›´è¿ï¼‰â€ï¼Œæé«˜è·¨ç½‘ç»œç¯å¢ƒå¯ç§»æ¤æ€§ã€‚
- é”™è¯¯å¤„ç†é“¾è·¯ä»â€œç»Ÿä¸€é‡è¯•â€ç»†åŒ–ä¸ºâ€œå¯é‡è¯•/ä¸å¯é‡è¯•åˆ†æµâ€ï¼ŒçŠ¶æ€æ”¶æ•›é€Ÿåº¦å’Œå¯è§‚æµ‹æ€§æ˜¾è‘—æå‡ã€‚

---

## 2026-02-10 (Server Hotfix): ä¿®å¤ Embedding SSL EOF å›å½’

### ğŸ¯ ç›®æ ‡
ä¿®å¤ä¸Šä¼ ç´¢å¼•æµç¨‹ä¸­ç”±ç½‘ç»œè¡¥ä¸å¼•å…¥çš„ `SSLEOFError` å›å½’ï¼Œæ¢å¤ç¨³å®šçš„å‘é‡åŒ–è°ƒç”¨é“¾è·¯ã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **SmartEmbedding ç½‘ç»œç­–ç•¥å›é€€**:
  - ç§»é™¤ `smart_embedding` ä¸­â€œæ¸…ç©ºä»£ç†ç¯å¢ƒå˜é‡ + æ¯æ¬¡é‡å»ºå®¢æˆ·ç«¯â€çš„é«˜é£é™©é€»è¾‘ã€‚
  - æ¢å¤ä¼˜å…ˆä½¿ç”¨å…¨å±€åˆå§‹åŒ–çš„ `self.embed_model` è¿›è¡Œæ‰¹é‡ embedding è°ƒç”¨ï¼Œä¿æŒä¸æœåŠ¡å¯åŠ¨æ—¶ä¸€è‡´çš„ç½‘ç»œ/SSLè¡Œä¸ºã€‚
  - ä»…åœ¨å…¨å±€æ¨¡å‹ç¼ºå¤±æ—¶ï¼Œæ‰ä½¿ç”¨ `DASHSCOPE_EMBED_API_KEY -> DASHSCOPE_API_KEY` å…œåº•åˆ›å»ºä¸´æ—¶æ¨¡å‹ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº†æ–‡ä»¶ä¸Šä¼ åè¿›å…¥ embedding é˜¶æ®µé«˜æ¦‚ç‡è§¦å‘ï¼š
  - `HTTPSConnectionPool(... SSLEOFError: UNEXPECTED_EOF_WHILE_READING)` çš„å›å½’é—®é¢˜ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å…³é”®è°ƒç”¨é“¾ä»â€œè¿è¡Œæ—¶åŠ¨æ€æ”¹ç½‘ç»œç¯å¢ƒâ€æ”¶æ•›ä¸ºâ€œå¯åŠ¨æœŸç»Ÿä¸€é…ç½® + è¿è¡ŒæœŸç¨³å®šå¤ç”¨â€ï¼Œé™ä½äº†ç¯å¢ƒç›¸å…³ä¸ç¡®å®šæ€§ä¸çº¿ä¸Šæ¼‚ç§»é£é™©ã€‚

---

## 2026-02-10 (Server Fix): ä¸Šä¼ é“¾è·¯é‰´æƒå¤±è´¥ä¸ä»»åŠ¡çŠ¶æ€çº å

### ğŸ¯ ç›®æ ‡
ä¿®å¤æœåŠ¡ç«¯æ–‡ä»¶ä¸Šä¼ ååœ¨å‘é‡åŒ–é˜¶æ®µé¢‘ç¹å¤±è´¥çš„é—®é¢˜ï¼Œå¹¶ç¡®ä¿å¤±è´¥çŠ¶æ€èƒ½è¢«å‰ç«¯å‡†ç¡®æ„ŸçŸ¥ã€‚

### âœ¨ æ–°å¢ (Added)
- **å¤±è´¥åŸå› é€å‡º**:
  - `GET /api/v1/files/{doc_id}/status` åœ¨ `failed` çŠ¶æ€ä¸‹æ–°å¢ `error` å­—æ®µï¼Œç›´æ¥è¿”å›åç«¯è®°å½•çš„å¤±è´¥åŸå› ï¼Œä¾¿äºå‰ç«¯æç¤ºä¸æ’éšœã€‚

### ğŸ› ï¸ å˜æ›´ (Changed)
- **Embedding Key è§£æç­–ç•¥**:
  - `SmartEmbeddingManager` æ–°å¢ `_resolve_embed_api_key()`ï¼Œä¼˜å…ˆè¯»å– `DASHSCOPE_EMBED_API_KEY`ï¼Œå†å›é€€åˆ° `DASHSCOPE_API_KEY`ã€‚
  - ç»Ÿä¸€ä½¿ç”¨ `settings.EMBED_MODEL_NAME`ï¼Œé¿å…ç¡¬ç¼–ç æ¨¡å‹åé€ æˆé…ç½®æ¼‚ç§»ã€‚

### ğŸ ä¿®å¤ (Fixed)
- **é‰´æƒé”™è¯¯æ ¹å› ä¿®å¤**:
  - ä¿®å¤äº†åµŒå…¥è¯·æ±‚é‡å»ºå®¢æˆ·ç«¯æ—¶é”™è¯¯è¯»å– `DASHSCOPE_API_KEY` çš„é—®é¢˜ï¼Œé¿å…ä»…é…ç½® `DASHSCOPE_EMBED_API_KEY` æ—¶å‡ºç° `AuthenticationError`ã€‚
- **ä»»åŠ¡çŠ¶æ€ä¸€è‡´æ€§ä¿®å¤**:
  - `ingestion` æµæ°´çº¿æ•è·å¼‚å¸¸åä¸å†é™é»˜åæ‰ï¼Œè€Œæ˜¯å†™å…¥ `FAILED` çŠ¶æ€åé‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢ Celery ä»»åŠ¡è¢«è¯¯è®°ä¸º `success`ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- **çŠ¶æ€é“¾è·¯æ›´é—­ç¯**:
  - å…³é”®å˜é‡æµå‘ä» `Embedding API Key` -> `SmartEmbeddingManager` -> `DashScopeEmbedding` è°ƒç”¨é“¾å®ç°å•ä¸€æ¥æºé…ç½®ã€‚
  - å…³é”®çŠ¶æ€æµå‘ä» `ingestion å¼‚å¸¸` -> `Document.status/error_msg` -> `status API` -> `å‰ç«¯æç¤º` å½¢æˆå¯è§‚æµ‹é—­ç¯ã€‚

---

## 2026-02-09 (UI Polish): ç©ºçŠ¶æ€ä¸è§†è§‰å¾®è°ƒ

### ğŸ¯ ç›®æ ‡
ä¼˜åŒ–åº”ç”¨åœ¨åˆæ¬¡ä½¿ç”¨æˆ–å†…å®¹ä¸ºç©ºæ—¶çš„è§†è§‰ä½“éªŒï¼Œæ¶ˆé™¤å•è°ƒæ„Ÿï¼Œå¼•å¯¼ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ã€‚

### âœ¨ ä½“éªŒä¼˜åŒ– (Changed)
- **é¦–é¡µç©ºçŠ¶æ€ (Home)**:
  - ç§»é™¤äº†å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºâ€œæˆ‘çš„ç¬”è®°æœ¬â€çš„é€»è¾‘ï¼Œå…è®¸çº¯å‡€å¯åŠ¨ã€‚
  - ä¼˜åŒ–äº†é¦–é¡µæ— ç¬”è®°æ—¶çš„å¼•å¯¼é¡µè®¾è®¡ (å¤§å›¾æ ‡ + CTA å¼•å¯¼)ã€‚
- **æ¥æºåˆ—è¡¨ç©ºçŠ¶æ€ (Sources)**:
  - ä¸ºç¬”è®°è¯¦æƒ…é¡µçš„æ¥æºåˆ—è¡¨è®¾è®¡äº†å…¨æ–°çš„ç©ºçŠ¶æ€ã€‚
  - å¢åŠ äº†å±…ä¸­çš„ `CloudUpload` å›¾æ ‡ã€æè¿°æ€§æ–‡å­—ä»¥åŠâ€œç«‹å³å¯¼å…¥â€çš„å¿«æ·æŒ‰é’®ï¼Œæ“ä½œè·¯å¾„æ›´çŸ­ã€‚

### ğŸ› ï¸ æ¶æ„è°ƒæ•´ (Architecture)
- **AppState**: å½»åº•ç§»é™¤äº† `seedDemoData` æ–¹æ³•ï¼Œå‡€åŒ–äº†åˆå§‹åŒ–é€»è¾‘ã€‚

---

## 2026-02-09 (Feature): æ™ºèƒ½æœç´¢ä¸æ–‡æ¡£åˆ†ç±»

### ğŸ¯ ç›®æ ‡
å®ç°åŸºäº Emoji çš„æ–‡æ¡£æ™ºèƒ½åˆ†ç±»ï¼Œå¹¶æä¾›å…¨åŸŸç¬”è®°æœç´¢åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æå‡ä¿¡æ¯ç»„ç»‡æ•ˆç‡ã€‚

### âœ¨ æ–°å¢åŠŸèƒ½ (Added)
- **æ™ºèƒ½åˆ†ç±» (Classification)**:
  - åç«¯é›†æˆ LLM åˆ†ç±»æœåŠ¡ï¼Œèƒ½å¤Ÿæ ¹æ®æ–‡æ¡£å†…å®¹è‡ªåŠ¨æ‰“æ ‡ Emoji (å¦‚ ğŸ“ æ•°å­¦, âš›ï¸ ç‰©ç†)ã€‚
  - `Document` æ¨¡å‹æ–°å¢ `emoji` å­—æ®µï¼Œå¹¶åœ¨æ–‡ä»¶ä¸Šä¼ /ç´¢å¼•é˜¶æ®µè‡ªåŠ¨æ‰§è¡Œåˆ†ç±»ã€‚
  - æ–°å¢ API `/files/{id}/classify` æ”¯æŒæŒ‰éœ€é‡åˆ†ç±»ã€‚
- **æ™ºèƒ½æœç´¢æ  (Interactive Search)**:
  - é¦–é¡µæ–°å¢æ‚¬æµ®å¼æœç´¢æ ï¼Œæ”¯æŒå¹³æ»‘å±•å¼€/æ”¶èµ·åŠ¨ç”»ã€‚
  - å®ç°äº†åŸºäºæ ‡é¢˜å’Œæ‘˜è¦çš„å®æ—¶ç¬”è®°è¿‡æ»¤åŠŸèƒ½ã€‚
  - ä¼˜åŒ–äº†æ— æœç´¢ç»“æœæ—¶çš„ç©ºçŠ¶æ€å±•ç¤ºã€‚

### ğŸ› ï¸ æ¶æ„è°ƒæ•´ (Architecture)
- **Database**: `documents` è¡¨æ–°å¢ `emoji` åˆ— (Migration `015ec0f3c03d`)ã€‚
- **State Management**: `AppState` æ–°å¢æœç´¢çŠ¶æ€ç®¡ç†ï¼Œè§£è€¦äº†æ•°æ®æºä¸è§†å›¾å±•ç¤ºã€‚

---

## 2026-02-08 (Docs & License): é¡¹ç›®æ–‡æ¡£æ ‡å‡†åŒ–

### ğŸ¯ ç›®æ ‡
å®Œæˆé¡¹ç›®æ–‡æ¡£çš„å…¨é¢é‡æ„ï¼Œæ˜ç¡®æŠ€æœ¯è·¯çº¿å›¾ï¼Œå¹¶é…ç½®æ ‡å‡†å¼€æºåè®®ã€‚

### âœ¨ æ–‡æ¡£æ›´æ–° (Added)
- **Apache 2.0 License**: æ­£å¼é…ç½®å¼€æºè®¸å¯è¯æ–‡ä»¶ã€‚
- **README Pro**: å…¨é¢é‡å†™é¡¹ç›®ä¸»æ–‡æ¡£ï¼Œæ¶µç›–æ ¸å¿ƒæ¶æ„ã€åŒå±‚å»é‡ç®—æ³•ã€æŠ€æœ¯æ ˆé€‰å‹åŠæœªæ¥è·¯çº¿å›¾ã€‚

---

## 2026-02-08 (UI Refinement): è§†è§‰ä½“éªŒæ‰“ç£¨ä¸é£æ ¼å›å½’

### ğŸ¯ ç›®æ ‡
æå‡å…¨ç•Œé¢çš„é˜…è¯»èˆ’é€‚åº¦ï¼Œæ¢å¤å¹¶ä¼˜åŒ–ç®€çº¦çš„è¾“å…¥æ¡†é£æ ¼ã€‚

### âœ¨ ä½“éªŒä¼˜åŒ– (Changed)
- **å­—ä½“å…¨é¢å‡çº§**: 
  - è°ƒå¤§äº†å…¨å±€å­—ä½“åŸºå‡†ï¼ˆBody 16-18pt, Title 22ptï¼‰ã€‚
  - èŠå¤©æ­£æ–‡æå‡è‡³ 17ptï¼Œæ˜¾è‘—å¢å¼ºäº†é˜…è¯»æ¸…æ™°åº¦ã€‚
- **è¾“å…¥æ¡†æ ·å¼å›å½’**:
  - æ¢å¤äº†ç»å…¸çš„â€œå•æ¨ªçº¿ (Underline)â€äº¤äº’é£æ ¼ã€‚
  - ä¼˜åŒ–äº†æ¿€æ´»çŠ¶æ€ä¸‹çš„çº¿æ¡ç²—ç»†ä¸é¢œè‰²è¿‡æ¸¡ï¼Œè§†è§‰æ›´åŠ è½»ç›ˆã€ç°ä»£ã€‚

---

## 2026-02-08 (Final Polish): äº¤äº’ä½“éªŒå¤§æ”¹ç‰ˆä¸åˆ é™¤åŠŸèƒ½é—­ç¯

### ğŸ¯ ç›®æ ‡
æå‡è·¨å¹³å°ï¼ˆPC/ç§»åŠ¨ç«¯ï¼‰çš„è¾“å…¥ä¸æ“ä½œä½“éªŒï¼Œå®ç°æºæ–‡ä»¶çš„æ·±åº¦ç®¡ç†ï¼ˆç´¢å¼•æ¸…ç†ï¼‰ï¼Œå¹¶å®Œæˆå…¨ç•Œé¢ä¸­æ–‡æœ¬åœ°åŒ–ã€‚

### âœ¨ æ–°å¢åŠŸèƒ½ (Added)
- **æºæ–‡ä»¶æ·±åº¦åˆ é™¤**:
  - ä¸ºæ–‡ä»¶å¡ç‰‡å¢åŠ äº†çº¢è‰²åƒåœ¾æ¡¶å›¾æ ‡ã€‚
  - **ç´¢å¼•åŒæ­¥æ¸…ç†**: åˆ é™¤æ“ä½œä¼šåŒæ­¥ç§»é™¤æœåŠ¡å™¨å‘é‡åº“ä¸­çš„ç›¸å…³èŠ‚ç‚¹ï¼Œç¡®ä¿ RAG æ£€ç´¢ç»“æœçš„å®æ—¶å‡†ç¡®æ€§ã€‚
- **AI æ°”æ³¡åŠ¨ä½œæ **:
  - **å¤åˆ¶åŠŸèƒ½**: æ”¯æŒä¸€é”®å¤åˆ¶ AI å›å¤çš„çº¯æ–‡æœ¬ï¼ˆå« Emojiï¼‰ï¼Œå¹¶æä¾›ç®€çº¦ç¾è§‚çš„æµ®åŠ¨æç¤ºã€‚
  - **åˆ†äº«æ¥å£**: é¢„ç•™äº†åˆ†äº«åŠŸèƒ½å…¥å£ã€‚
  - **è‡ªé€‚åº”åŠ¨ç”»**: ç§»åŠ¨ç«¯æ”¯æŒç‚¹å‡»æ°”æ³¡åé€šè¿‡å¹³æ»‘åŠ¨ç”»å±•å¼€åŠ¨ä½œå›¾æ ‡ï¼Œç”µè„‘ç«¯åˆ™ç›´æ¥æ˜¾ç¤ºã€‚

### ğŸ› ï¸ äº¤äº’ä¼˜åŒ– (Changed)
- **æ™ºèƒ½è¾“å…¥æ¡†**:
  - **ç”µè„‘ç«¯**: å®ç° `Enter` é”®ç›´æ¥å‘é€ï¼Œ`Ctrl + Enter` æ¢è¡Œï¼Œæå¤§åœ°æå‡äº†å¯¹è¯æ•ˆç‡ã€‚
  - **ç§»åŠ¨ç«¯**: ä¿æŒ `Enter` æ¢è¡Œçš„åŸç”Ÿä¹ æƒ¯ï¼Œé¿å…è¯¯å‘ã€‚
  - å¢åŠ äº†è‡ªåŠ¨å¢é«˜çš„å¤šè¡Œè¾“å…¥æ”¯æŒã€‚
- **å…¨ç•Œé¢æœ¬åœ°åŒ–**: å°†æ‰€æœ‰ UI æ ‡ç­¾ã€å¯¼èˆªã€å¼¹çª—æç¤ºåŠå ä½ç¬¦ç»Ÿä¸€ä¸ºä¸­æ–‡è¡¨è¿°ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤äº† `AppState` å’Œ `ChatPage` åœ¨å¤„ç†å¤æ‚å¼‚æ­¥äº¤äº’æ—¶çš„ä¸Šä¸‹æ–‡ç¨³å®šæ€§é—®é¢˜ã€‚

---

## 2026-02-08 (Refined): æ¶æ„å®¡è®¡ä¸ RAG æ·±åº¦ä¼˜åŒ–

### ğŸ¯ ç›®æ ‡
æ‰§è¡Œè´¨é‡å®ˆå«è€… (Quality Guardian) å®¡è®¡ï¼Œå½»åº•è§£å†³åç«¯è„æ•°æ®æ®‹ç•™ã€RAG æ£€ç´¢é‡å¤å†…å®¹åŠè‡ªæ£€é€»è¾‘ä¸å½»åº•çš„é—®é¢˜ã€‚

### ğŸ› ï¸ æ ¸å¿ƒä¿®å¤ (Architecture & Dedup)
- **åç«¯ (API & RAG)**:
  - **è‡ªæ„ˆå¼ /check**: æ¥å£ç°åœ¨åœ¨æ£€æŸ¥å“ˆå¸Œå‰ä¼šä¸»åŠ¨æ¸…ç†æ•°æ®åº“ä¸­çŠ¶æ€å¼‚å¸¸æˆ–ç´¢å¼•ä¸¢å¤±çš„æ—§è®°å½•ï¼Œç¡®ä¿ä¸Šä¼ é“¾è·¯ 100% ç•…é€šã€‚
  - **RAG å†…å®¹å»é‡**: å¼•å…¥äº†æ£€ç´¢èŠ‚ç‚¹çš„å†…å®¹çº§å»é‡ (Node Deduplication)ï¼Œå³ä¾¿ç”¨æˆ·é€‰æ‹©äº†å¤šä¸ªé‡å¤æ–‡ä»¶ï¼ŒAI ä¹Ÿåªä¼šå‚è€ƒä¸€ä»½å”¯ä¸€å†…å®¹ï¼Œæ¶ˆé™¤äº†â€œç³»ç»Ÿæ£€æµ‹åˆ°é‡å¤â€çš„å†—ä½™å›ç­”ã€‚
  - **æ·±åº¦å¬å›**: å°† `similarity_top_k` æå‡è‡³ 15ï¼Œç¡®ä¿å»é‡åä»æœ‰å……è¶³çš„ä¸Šä¸‹æ–‡ã€‚
- **å‰ç«¯ (Flutter)**:
  - **å“ˆå¸ŒæŒä¹…åŒ–**: `SourceItem` ç°åœ¨ä¼šæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶å“ˆå¸Œå€¼ã€‚
  - **æœ¬åœ°è‡ªæ£€è¿›åŒ–**: `checkNotebookHealth` ç°åœ¨èƒ½åŒæ—¶è¯†åˆ«â€œåç«¯ä¸å­˜åœ¨ (404)â€å’Œâ€œæœ¬åœ°å“ˆå¸Œé‡å¤â€ä¸¤ç§å¼‚å¸¸ï¼Œå¹¶æ‰§è¡Œç‰©ç†æ¸…ç†ã€‚
  - **å¼¹çª—äº¤äº’**: ä¼˜åŒ–äº†æ¸…ç†ç»“æœçš„å¼¹çª—åé¦ˆã€‚

### âœ¨ ä½“éªŒä¼˜åŒ–
- **UI ç»†èŠ‚**: ç»Ÿä¸€è‹±æ–‡å­—ä½“ä¸º `Consolas`ï¼Œä¼˜åŒ–äº†èŠå¤©æ°”æ³¡çš„æœ€å¤§å®½åº¦é™åˆ¶ (75%)ã€‚
- **äº¤äº’é€»è¾‘**: å®ç°äº†ç¬”è®°æœ¬é¦–æ¬¡æ‰“å¼€æ»šåˆ°é¡¶ã€éšåè®°å¿†ä½ç½®çš„æ™ºèƒ½æ»šåŠ¨é€»è¾‘ã€‚

---

## 2026-02-08 (Update): Stress Testing & Architecture Reinforcement

### ğŸ¯ ç›®æ ‡
é’ˆå¯¹ç”¨æˆ·é«˜é¢‘æ“ä½œä¸å¼‚å¸¸è¡Œä¸ºè¿›è¡Œå‹åŠ›æµ‹è¯•ï¼ŒåŠ å›ºå‰ç«¯çŠ¶æ€ç®¡ç†æ¶æ„ï¼Œç¡®ä¿åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ã€‚

### ğŸ› ï¸ æ ¸å¿ƒä¿®å¤ (Architecture & Stability)
- **AppState é‡æ„**:
  - **LIFO Bug ä¿®å¤**: ä»»åŠ¡çŠ¶æ€æ›´æ–°ä»â€œé»˜è®¤ç´¢å¼• 0â€æ”¹ä¸ºåŸºäº `jobId` çš„ç²¾ç¡®åŒ¹é…ï¼Œå½»åº•è§£å†³äº†å¹¶å‘ä¸Šä¼ æ—¶çŠ¶æ€é”™ä½çš„é—®é¢˜ã€‚
  - **å…¨å±€å¤„ç†é”**: å¼•å…¥ `isProcessing` çŠ¶æ€ï¼Œå®ç°äº†è·¨é¡µé¢çš„å…¨å±€äº’æ–¥é”ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»å¯¼è‡´çš„ LLM è¯·æ±‚æµªè´¹ã€‚
  - **ä¾èµ–æ³¨å…¥**: ä¸º `AppState` å¢åŠ äº†æ„é€ å‡½æ•°æ³¨å…¥æ”¯æŒï¼Œæå¤§æ–¹ä¾¿äº†å•å…ƒæµ‹è¯•ä¸ Mock å¼€å‘ã€‚
- **UI å¢å¼º**:
  - **å¼‚å¸¸åé¦ˆ**: æ¥æºåˆ—è¡¨ä¸ä»»åŠ¡å¡ç‰‡ç°åœ¨æ”¯æŒçº¢è‰²é«˜äº®çš„é”™è¯¯çŠ¶æ€æç¤º (`SourceStatus.failed`)ã€‚
  - **è·¨é¡µé¢çŠ¶æ€ä¿æŒ**: Loading åŠ¨ç”»ä¸å†å› é¡µé¢åˆ‡æ¢è€Œæ¶ˆå¤±ï¼ŒUI èƒ½å¤Ÿæ ¹æ®å…¨å±€çŠ¶æ€å®æ—¶åŒæ­¥è¿›åº¦ã€‚

### ğŸ§ª è´¨é‡ä¿è¯ (QA)
- **å‹åŠ›æµ‹è¯•é›†**: æ–°å¢äº†é’ˆå¯¹å¹¶å‘ä»»åŠ¡åˆ›å»ºã€æµå¼ä¼ è¾“ä¸­åˆ é™¤ã€é‡å¤ç‚¹å‡»ç”Ÿæˆç­‰åœºæ™¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚
- **Widget Test**: ä¿®æ­£äº† `widget_test.dart` çš„ç¼–è¯‘é”™è¯¯ï¼Œç¡®ä¿åŸºç¡€å†’çƒŸæµ‹è¯•é€šè¿‡ã€‚

## 2026-02-08: Full Stack Stabilization & Feature Polish

### ğŸ¯ ç›®æ ‡
å®Œæˆ RAG å…¨é“¾è·¯è°ƒè¯•ï¼Œä¿®å¤æ ¸å¿ƒ Bugï¼Œå¹¶å®ç°å‰ç«¯ä½“éªŒå‡çº§ï¼ˆæŒä¹…åŒ–ã€å­—ä½“ã€é€‰æ‹©ï¼‰ä¸åç«¯æ¶æ„ä¼˜åŒ–ã€‚

### ğŸ› ï¸ æ ¸å¿ƒä¿®å¤ (Stability)
- **Server Startup**: ä¿®å¤äº† `main.py` å’Œ `celery_app.py` ä¸­ LlamaIndex åˆå§‹åŒ–çš„ç«æ€æ¡ä»¶ã€‚
- **Celery Task**: ä¿®å¤äº† `unregistered task` é”™è¯¯ï¼ˆé€šè¿‡æ˜¾å¼æ·»åŠ  `include` å‚æ•°ï¼‰ã€‚
- **Client Bug**: ä¿®å¤äº†èŠå¤©æ¶ˆæ¯ ID ç¢°æ’å¯¼è‡´çš„å›å¤è¦†ç›–é—®é¢˜ã€‚
- **Smart Embedding**: ä¿®å¤äº†ç§’ä¼ å»é‡å¤±æ•ˆçš„é—®é¢˜ï¼ˆæ’é™¤äº†åŠ¨æ€ Metadata å¹²æ‰°ï¼‰ã€‚

### âœ¨ å‰ç«¯å‡çº§ (Frontend)
- **æ•°æ®æŒä¹…åŒ–**: å®ç°äº†åŸºäº JSON çš„æœ¬åœ°å­˜å‚¨ (`PersistenceService`)ï¼Œè§£å†³äº†é‡å¯ä¸¢å¤±æ•°æ®çš„é—®é¢˜ã€‚
- **è§†è§‰ä¼˜åŒ–**: 
  - å…¨å±€å­—ä½“å‡çº§ä¸º **SimHei** (é»‘ä½“)ã€‚
  - èŠå¤©å­—ä½“å‡çº§ä¸º **GWMSansUI** (ç°ä»£åŒ–çº¿æ¡)ã€‚
  - å¼•å…¥ `SelectionArea` æ”¯æŒè·¨æ®µè½å…¨é€‰å¤åˆ¶ã€‚
- **äº¤äº’ä¼˜åŒ–**: æ¥æºåˆ—è¡¨å¢åŠ äº†â€œæ¸…é™¤å·²å®Œæˆä»»åŠ¡â€çš„æŒ‰é’®ã€‚

### âš™ï¸ åç«¯ä¼˜åŒ– (Backend & DevOps)
- **Prompt å·¥ç¨‹**: å°†ç¡¬ç¼–ç çš„ Prompt åˆ†ç¦»ä¸ºå¤–éƒ¨ Markdown æ¨¡æ¿ (`server/app/templates/*.md`)ã€‚
- **æ¨¡å‹é…ç½®**: æ¥å…¥ DashScope (Qwen)ï¼Œå¹¶å°† `max_tokens` è°ƒæ•´ä¸º 4096 ä»¥æ”¯æŒé•¿æ–‡ç”Ÿæˆã€‚
- **DevOps**: åˆ›å»ºäº† `server/manage.py`ï¼Œå®ç°äº† Redis/Celery/API çš„ä¸€é”®å¯åŠ¨ä¸ç»Ÿä¸€ç®¡ç†ã€‚

## 2026-02-07: å…¨é¢ä½“éªŒå‡çº§ä¸ç¨³å®šæ€§ä¿®å¤

### ğŸ¯ ç›®æ ‡
åœ¨å®Œæˆæ¶æ„é‡æ„çš„åŸºç¡€ä¸Šï¼Œé‡ç‚¹ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆæµå¼å¯¹è¯ï¼‰å’Œç³»ç»Ÿç¨³å®šæ€§ï¼ˆBugä¿®å¤ï¼‰ã€‚

### ğŸ› ï¸ ä¿®å¤ä¸ä¼˜åŒ–
- **Bug Fixes**:
  - ä¿®å¤äº† `files.py` ä¸­ä¸¥é‡çš„ç¼©è¿›é”™è¯¯ã€‚
  - ä¿®å¤äº†è·¨ Notebook ç´¢å¼•é€»è¾‘ï¼šç§’ä¼ æ–‡ä»¶ç°åœ¨ä¼šæ­£ç¡®è§¦å‘ç´¢å¼•ä»»åŠ¡ã€‚
  - ä¿®å¤äº† API Client ç±»å‹æ¨æ–­é”™è¯¯ (`Map<String, dynamic>`)ã€‚
- **æ€§èƒ½ä¼˜åŒ–**:
  - åç«¯å¼•å…¥ `lru_cache` ç¼“å­˜å‘é‡ç´¢å¼•ï¼Œé¿å…æ¯æ¬¡å¯¹è¯éƒ½é‡æ–°åŠ è½½ç£ç›˜æ–‡ä»¶ã€‚

### âœ¨ æ–°å¢åŠŸèƒ½
- **æµå¼å¯¹è¯ (Streaming Chat)**: 
  - åç«¯ `/chat/query` å‡çº§ä¸º SSE (Server-Sent Events) æ¥å£ã€‚
  - å‰ç«¯å®ç°äº†æ‰“å­—æœºæ•ˆæœï¼Œé€å­—æ˜¾ç¤º AI å›å¤ã€‚
- **API Client**: å¢åŠ äº† `queryStream` æ–¹æ³•ï¼Œæ”¯æŒé•¿è¿æ¥å’Œå®æ—¶æ•°æ®è§£æã€‚

### ğŸ“ å¾…åŠäº‹é¡¹ (TODO)
- [ ] æ¥å…¥ Qdrant å‘é‡æ•°æ®åº“ä»¥æ”¯æŒæ›´å¤§è§„æ¨¡æ•°æ®ã€‚
- [ ] å®ç°å‰ç«¯æ•°æ®æœ¬åœ°æŒä¹…åŒ–ã€‚
## 2026-02-10 (Stability Hardening): å®¡æŸ¥æŠ¥å‘Šé—­ç¯ä¿®å¤ï¼ˆP0/P1/P2ï¼‰

### ğŸ¯ ç›®æ ‡
æŒ‰ã€ŠConsolidated_Review_Report.mdã€‹é€é¡¹ä¿®å¤é«˜é£é™©ç¼ºé™·ï¼Œå®Œæˆå‰ç«¯äº¤äº’å´©æºƒç‚¹ã€æµå¼å¯¹è¯å¯æ§æ€§ã€åç«¯æ•°æ®ä¸€è‡´æ€§ä¸ç¼“å­˜éš”ç¦»çš„é—­ç¯åŠ å›ºã€‚

### âœ¨ æ–°å¢ (Added)
- å‰ç«¯æ–°å¢å¯ä¸­æ–­çš„æµå¼ä¼šè¯æ§åˆ¶ï¼š
  - `StreamCancelToken`ï¼ˆ`client/lib/core/api_client.dart`ï¼‰
  - èŠå¤©è¾“å…¥åŒºæ–°å¢â€œåœæ­¢ç”Ÿæˆâ€æŒ‰é’®ï¼ˆ`client/lib/features/chat/chat_page.dart`ï¼‰
- åç«¯æ–°å¢æ•°æ®åº“è¿ç§»ï¼š
  - `server/alembic/versions/7c2c5e9f1d4a_harden_document_and_cache_constraints.py`
  - ä¸º `documents.status` å¢åŠ åˆæ³•å€¼çº¦æŸ
  - ä¸º `documents` å¢åŠ  `(notebook_id, file_hash)` å”¯ä¸€çº¦æŸ
  - å°† `chunk_cache` å‡çº§ä¸º `(text_hash, model_name)` å¤åˆä¸»é”®

### ğŸ› ï¸ å˜æ›´ (Changed)
- `NotebookPage` åœ¨ç›®æ ‡ç¬”è®°æœ¬è¢«åˆ é™¤æ—¶ä¸å† `firstWhere` å´©æºƒï¼Œæ”¹ä¸ºå®‰å…¨æç¤ºå¹¶è¿”å›ä¸Šçº§é¡µé¢ã€‚
- èŠå¤©é”®ç›˜äº‹ä»¶å¤„ç†æ”¹ä¸º `KeyEventResult.handled`ï¼Œä¿®å¤æ¡Œé¢ç«¯ Enter å‘é€åæ®‹ç•™ç©ºè¡Œã€‚
- èŠå¤© SSE è¶…æ—¶ä» `60s` æ”¶æ•›ä¸º `30s`ï¼Œå¹¶åœ¨å–æ¶ˆ/å¼‚å¸¸åæ¢å¤è¾“å…¥çŠ¶æ€ã€‚
- `AppState.isProcessing` æ‰©å±•ä¸ºâ€œå…¨å±€å¤„ç†ä¸­ + æ¥æºå¤„ç†ä¸­â€è”åˆåˆ¤å®šï¼Œä¸Šä¼ å¤„ç†ä¸­ç¦å‘æ¶ˆæ¯ã€‚
- æ¥æºåˆ é™¤äº¤äº’å¢åŠ é˜²æŠ–ä¸åé¦ˆï¼šåˆ é™¤æŒ‰é’® loadingã€å¤±è´¥æç¤ºã€æˆåŠŸæç¤ºã€‚
- ä¸Šä¼ çŠ¶æ€æ˜ å°„ä¿®æ­£ï¼š`already_exists -> SourceStatus.ready`ï¼Œå¹¶åŒæ­¥åˆå§‹é˜¶æ®µæ–‡æ¡ˆä¸ºâ€œå¤„ç†å®Œæˆâ€ã€‚
- `SmartEmbeddingManager` æŸ¥è¯¢ç¼“å­˜æ—¶åŠ å…¥ `model_name` æ¡ä»¶ï¼Œé¿å…è·¨æ¨¡å‹è¯¯å¤ç”¨æ—§å‘é‡ã€‚
- æ–‡ä»¶ä¸Šä¼ æ¥å£å¢åŠ å‰ç½®é‡å¤æ£€æµ‹å’Œå¹¶å‘å†²çªå…œåº•ï¼Œé™ä½è„æ•°æ®æ—¶ä»£ç è·¯å¾„å¼‚å¸¸æ¦‚ç‡ã€‚

### ğŸ ä¿®å¤ (Fixed)
- ä¿®å¤ç¬”è®°æœ¬åœ¨å¼‚ç«¯åˆ é™¤åé¡µé¢é‡å»ºå´©æºƒé—®é¢˜ã€‚
- ä¿®å¤èŠå¤©è¾“å…¥ Enter ä¸ TextField é»˜è®¤è¡Œä¸ºå†²çªå¯¼è‡´çš„é¢å¤–æ¢è¡Œé—®é¢˜ã€‚
- ä¿®å¤æµå¼è¯·æ±‚å¡æ­»åå‰ç«¯é•¿æœŸå¤„äºä¸å¯è¾“å…¥çŠ¶æ€çš„é—®é¢˜ã€‚
- ä¿®å¤æ¥æºåˆ é™¤â€œæ— åŠ è½½ã€æ— é”™è¯¯æç¤ºâ€çš„é™é»˜å¤±è´¥ä½“éªŒç¼ºé™·ã€‚
- ä¿®å¤ `already_exists` è¢«é”™è¯¯æ˜ å°„ä¸º `queued/processing` å¯¼è‡´ UI é•¿æ—¶é—´è½¬åœˆçš„é—®é¢˜ã€‚
- ä¿®å¤ `ChunkCache` ä»…æŒ‰ `text_hash` å‘½ä¸­é€ æˆä¸åŒ embedding æ¨¡å‹ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ã€‚
- ä¿®å¤åˆ é™¤æ–‡æ¡£å Artifact æ— å¼•ç”¨ä»æ®‹ç•™çš„ CAS å­¤å„¿æ–‡ä»¶é—®é¢˜ï¼ˆæ–°å¢å¼•ç”¨æ£€æŸ¥ + ç‰©ç†æ¸…ç†ï¼‰ã€‚

### ğŸ§± æ¶æ„å½±å“ (Architecture)
- å‰ç«¯å¯¹è¯é“¾è·¯ç”±â€œå•å‘ç­‰å¾…â€å‡çº§ä¸ºâ€œå¯å–æ¶ˆæµ + è¶…æ—¶æ”¶æ•› + çŠ¶æ€å¯æ¢å¤â€çš„å¯æ§çŠ¶æ€æœºã€‚
- åç«¯æ•°æ®å±‚ä»â€œå¼±çº¦æŸå­—ç¬¦ä¸²çŠ¶æ€ + å•é”®ç¼“å­˜â€å‡çº§ä¸ºâ€œå—çº¦æŸçŠ¶æ€ + å”¯ä¸€æ€§ä¿éšœ + æ¨¡å‹éš”ç¦»ç¼“å­˜é”®â€ã€‚
- æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸä»â€œåˆ æ–‡æ¡£å³ç»“æŸâ€å‡çº§ä¸ºâ€œåˆ æ–‡æ¡£ -> å¼•ç”¨æ£€æµ‹ -> Artifact/CAS æ¸…ç†â€çš„é—­ç¯å›æ”¶é“¾è·¯ã€‚

### âœ… éªŒè¯ (Verification)
- Flutter é™æ€æ£€æŸ¥ï¼š
  - `flutter analyze lib/app/app_state.dart lib/core/api_client.dart lib/features/chat/chat_page.dart lib/features/notebook/notebook_page.dart lib/features/sources/sources_page.dart`
- Python è¯­æ³•æ£€æŸ¥ï¼š
  - `python -m py_compile` è¦†ç›–ä¿®æ”¹åçš„ `models/services/endpoints/migration` æ–‡ä»¶
- Pytest å­é›†ï¼š
  - `tests/test_full_suite.py`ï¼ˆä¸Šä¼ ç”Ÿå‘½å‘¨æœŸï¼‰
  - `tests/test_smart_embedding_batching.py`
  - `tests/test_smart_embedding_key_resolution.py`
